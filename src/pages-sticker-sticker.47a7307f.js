import{_ as t}from"./tm-message.42d12b93.js";import{n as e,S as s,W as i,o,c as a,w as n,b as l,d as r,r as c,F as _,e as h,f as d,h as m,j as u,k as f}from"./index-f5cba0e4.js";import{r as p}from"./uni-app.es.62a9cda9.js";import{_ as g}from"./tm-input.4c1b57bc.js";import{_ as w}from"./tm-skeleton-line.9799a71e.js";import{_ as x}from"./tm-sheet.38d3d718.js";import{_ as k}from"./tm-icon.ed97db34.js";import{_ as y}from"./tm-app.c7c4bc54.js";import{g as v}from"./api.f04a1197.js";import{s as j}from"./sticker-card.b881b449.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import"./tm-text.d010834d.js";import"./useWindowInfo.47d82cea.js";import"./tm-button.37a1a22f.js";import"./useTheme.d1454919.js";const b=T({components:{stickerCard:j},data:()=>({vk:uni.vk,search_key:"",is_fixed:!1,dbName:"sticker",matetial_type:"sticker",choose_list_drawer_show:!1,first_loding:!0,action:"view",up_tips_show:!0,choose_show:!1,hideBtn:!1,is_full:!1,is_loading:!1,active_tabs_index:0,current_cid:1,current_index:1,current_id:"",current_zh_type:"全部",current_item:{},windowHeight:"",material_item:{item_list:[]},scrollTop:0,show_to_top:!1,nickname_list:[],avatar_list:[],can_max_choose:100}),computed:{},onPageScroll(t){t.scrollTop>200?this.show_to_top=!0:this.show_to_top=!1},onReachBottom(){this.get_list_data()},methods:{to_search(t){console.log("搜索",t),e({url:`/pages/search/search?search_key=${t}&search_type=sticker`})},finish_download(t){console.log("下载完成",t)},async click_down(t){console.log("父节点click_down",t),this.$refs.down_matetial.click_down(t)},async open_choose_list(){this.$refs.choose_list_popup.open("right")},previewImage(t){console.log("预览图片",t),s({current:t,urls:[t],loop:!0,longPressActions:{itemList:[],success:function(t){console.log("选中了第"+(t.tapIndex+1)+"个按钮,第"+(t.index+1)+"张图片")},fail:function(t){console.log(t.errMsg)}}})},to_top(){i({scrollTop:0,duration:300})},async get_list_data(){if(this.is_loadding)return;this.is_loadding=!0;let t=await v(this.dbName,{},1,30);if(console.log("res",t),0==t.code&&null!=t.data){let e=t.data;this.material_item.item_list=[...this.material_item.item_list,...e]}else if(0==t.code&&null==t.data)return;this.is_loadding=!1},async next_item(){if(this.current_index>=this.avatar_list.length-1)return console.log("no more"),void this.$refs.toast.show({text:"没有更多了",model:"info",mask:!0,wait:2e3});this.current_index++,this.current_item=this.avatar_list[this.current_index],this.avatar_list.length-this.current_index<=20&&(console.log("去加载下一页"),await this.get_list_data())},before_item(){if(this.current_index<=0)return console.log("is the first"),void this.$refs.toast.show({text:"已经是第一个了",model:"info",mask:!0,wait:2e3});this.current_index--,this.current_item=this.avatar_list[this.current_index]},start(t){this.clientX=t.changedTouches[0].clientX,this.clientY=t.changedTouches[0].clientY},async end(t){const e=t.changedTouches[0].clientX-this.clientX,s=t.changedTouches[0].clientY-this.clientY;s>50||e>50?(console.log("下滑或左划"),this.before_item()):(s<-50||e<-50)&&(console.log("上滑或右划"),this.next_item())},exit_full(){this.is_full=!1}},async onLoad(t={}){this.windowHeight=uni.vk.getVuex("$sys.sys.windowHeight")*uni.vk.getVuex("$sys.sys.devicePixelRatio")+"rpx",this.first_loding=!0,this.action=t.action||"view"},async onReady(){await this.get_list_data(),setTimeout((()=>{this.first_loding=!1}),200),"choose"==this.action?this.is_fixed=!0:this.is_fixed=!1}},[["render",function(e,s,i,v,j,T){const b=p(m("tm-message"),t),$=p(m("tm-input"),g),z=u,I=p(m("tm-skeleton-line"),w),S=p(m("tm-sheet"),x),V=f("sticker-card"),C=p(m("tm-icon"),k),H=p(m("tm-app"),y);return o(),a(H,null,{default:n((()=>[l(b,{ref:"toast"},null,512),l(z,{class:"my-20"},{default:n((()=>[l($,{searchWidth:160,height:80,fontSize:32,onSearch:T.to_search,prefix:"tmicon-search",searchLabel:"搜索",modelValue:j.search_key,"onUpdate:modelValue":s[0]||(s[0]=t=>j.search_key=t),modelModifiers:{lazy:!0}},null,8,["onSearch","modelValue"])])),_:1}),l(z,null,{default:n((()=>[j.first_loding?(o(),r(_,{key:0},c(10,((t,e)=>l(z,null,{default:n((()=>[l(S,{_class:"shadow-1 round-5",class:"round-5",padding:[20,30],margin:[25,10]},{default:n((()=>[l(z,{class:"flex flex-row flex-center"},{default:n((()=>[(o(),r(_,null,c(3,(t=>l(z,{class:"ma-10",style:{width:"210rpx"}},{default:n((()=>[l(I,{height:175,width:175})])),_:1}))),64))])),_:1})])),_:1})])),_:1}))),64)):(o(),a(z,{key:1},{default:n((()=>[l(V,{material_item:j.material_item,first_loding:j.first_loding,onClick_down:T.click_down,onTo_change_choose:e.to_change_choose,action:j.action},null,8,["material_item","first_loding","onClick_down","onTo_change_choose","action"])])),_:1}))])),_:1}),j.is_loading?(o(),a(z,{key:0,style:{"margin-bottom":"250rpx"}},{default:n((()=>[h("> "),l(C,{spin:"","font-size":50,name:"tmicon-loading",color:"blue"})])),_:1})):d("",!0)])),_:1})}],["__scopeId","data-v-68452380"]]);export{b as default};
