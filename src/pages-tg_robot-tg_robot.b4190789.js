import{a as t,ak as e,s as l,S as s,R as a,o as i,c as o,w as n,b as _,e as f,f as r,l as c,j as h,h as x}from"./index-f5cba0e4.js";import{_ as u}from"./tm-sheet.38d3d718.js";import{r as d}from"./uni-app.es.62a9cda9.js";import{_ as g}from"./tm-button.37a1a22f.js";import{_ as m}from"./tm-modal.70c18b3d.js";import{_ as p}from"./tm-app.c7c4bc54.js";import{_ as w}from"./_plugin-vue_export-helper.1b428a4d.js";import"./useTheme.d1454919.js";import"./tm-icon.ed97db34.js";import"./tm-translate.1353da0c.js";import"./tm-text.d010834d.js";import"./tm-overlay.d3e45220.js";import"./useWindowInfo.47d82cea.js";const k={128:"https://ffmpeg-hk-qxheahlpdm.cn-hongkong.fcapp.run",256:"https://ffmpeg-hk-qxhezifpdm.cn-hongkong.fcapp.run",512:"https://ffmpeg-hk-qxheeebpdm.cn-hongkong.fcapp.run",1024:"https://ffmpeg-hk-psehcznqnn.cn-hongkong.fcapp.run"};(new Date).getTime();let b={};const z=w({data:()=>({task_status:0,tg_file_list:[],had_finsh_num:0,wait_max_time:0}),async onLoad(e={}){console.log("onLoad",e),this.initData(),(null==e?void 0:e.extraData)&&(b=JSON.parse(decodeURIComponent(null==e?void 0:e.extraData)),console.log("options extraData",b),t("extraData",b),this.tg_file_list=(null==b?void 0:b.tg_file_list)||[])},methods:{initData(){console.log("初始化数据"),this.task_status=0,this.tg_file_list=[],this.had_finsh_num=0,this.wait_max_time=0},to_down_all(){console.log("下载全部");for(let t=0;t<this.tg_file_list.length;t++){let{oss_file_url:l,tr_type:s}=this.tg_file_list[t];"gif"!=s&&"png"!=s&&"webp"!=s&&"jpg"!=s||e(l,[l],!1)}},to_preview(){let t=[];console.log("this.tg_file_list",this.tg_file_list);for(let e=0;e<this.tg_file_list.length;e++){let{oss_file_url:l}=this.tg_file_list[e];l?(console.log("存在图片",l),t.push(l)):console.log("不存在图片",e)}console.log("img_url_list",t),t.length>0?l({title:"提示",content:"长按图片可保存!",success:e=>{s({urls:t,success:()=>{}})}}):l({title:"提示",content:"没有图片可预览,确保已成功生成!"})},async to_transform(){let t=[];console.log("添加进任务",this.tg_file_list,this.tg_file_list.length);for(let l=0;l<this.tg_file_list.length;l++)t.push(this.to_create_task(this.tg_file_list[l]));let e=await Promise.all(t);console.log("dataResList",e);for(let l=0;l<this.tg_file_list.length;l++){let{oss_file_url:t,oss_file_size:s}=e[l];t&&s&&(this.tg_file_list[l].oss_file_url=t,this.tg_file_list[l].oss_file_size=s)}this.task_status=1},to_create_task:async t=>(console.log("创建任务"),new Promise((async(e,l)=>{let{file_path:s,file_size:i,tr_type:o}=t;if(!s)return console.log("没有文件"),{};let n="128";n=parseInt(i/1024/1024)>4?"1024":parseInt(i/1024/1024)>2?"512":parseInt(i/1024/1024)>2?"256":"128";try{let t=await a({url:`${k[n]}/to_transform_tg_file`,method:"POST",data:{file_path:s,file_size:i,tr_type:o}});console.log("res------",t.data);let{oss_file_url:l,oss_file_size:_}=t.data;e({oss_file_url:l,oss_file_size:_})}catch(_){e({})}})))}},[["render",function(t,e,l,s,a,w){const k=c,b=h,z=d(x("tm-sheet"),u),j=d(x("tm-button"),g),y=d(x("tm-modal"),m),C=d(x("tm-app"),p);return i(),o(C,{color:"#1d1c22"},{default:n((()=>[_(b,null,{default:n((()=>[_(b,{class:"flex flex-row flex-center"},{default:n((()=>[_(z,{color:"#4c4959",round:5,shadow:0,margin:[20,30],width:500},{default:n((()=>[_(b,{class:"flex flex-col flex-center"},{default:n((()=>[_(k,{class:"text-weight-b text-white text-size-xl"},{default:n((()=>[f("提示")])),_:1}),_(k,{class:"text-weight-b text-white text-size-m ma-10"},{default:n((()=>[f("以下原因可能会导致生成失败")])),_:1})])),_:1}),_(b,{class:"flex flex-col"},{default:n((()=>[_(k,{class:"text-weight-s text-white text-size-s ma-10"},{default:n((()=>[f("1.中途切换页面,重新生成可解决")])),_:1}),_(k,{class:"text-weight-s text-white text-size-s ma-10"},{default:n((()=>[f("2.上传的文件太大,剪辑时长可解决")])),_:1}),_(k,{class:"text-weight-s text-white text-size-s ma-10"},{default:n((()=>[f("3.生成的文件太大,选择低画质可解决")])),_:1}),_(k,{class:"text-weight-s text-white text-size-s ma-10"},{default:n((()=>[f("4.代理网络存在问题,更改网络设置可解决")])),_:1})])),_:1})])),_:1})])),_:1}),0==a.task_status?(i(),o(b,{key:0,class:"flex flex-col flex-center"},{default:n((()=>[_(b,{class:"lds-hourglass"}),_(b,{class:"flex flex-col flex-center"},{default:n((()=>[_(k,{class:"text-weight-b text-white text-size-xl ma-20"},{default:n((()=>[f("正在努力生成中..")])),_:1}),_(k,{class:"text-weight-b text-white text-size-g"},{default:n((()=>[f("生成过程中勿切换页面")])),_:1})])),_:1}),_(b,{class:"flex flex-row flex-center"},{default:n((()=>[_(j,{label:"生成任务",width:500,round:20,disabled:!1,onClick:w.to_transform},null,8,["onClick"])])),_:1}),_(b,{class:"flex flex-row flex-center"},{default:n((()=>[_(j,{label:"重新生成",width:500,round:20,disabled:!0})])),_:1})])),_:1})):r("",!0),1==a.task_status?(i(),o(b,{key:1,class:"flex flex-col flex-center"},{default:n((()=>[_(b,{class:"image_ani"}),_(b,{class:"flex flex-col flex-center"},{default:n((()=>[_(k,{class:"text-weight-b text-white text-size-xl ma-20 text-green"},{default:n((()=>[f("生成成功")])),_:1}),_(j,{width:450,height:80,round:10,label:"查看/保存图片",onClick:w.to_preview},null,8,["onClick"]),_(j,{width:450,height:80,round:10,label:"直接下载全部",onClick:w.to_down_all},null,8,["onClick"])])),_:1})])),_:1})):r("",!0),2==a.task_status?(i(),o(b,{key:2,class:"flex flex-col flex-center"},{default:n((()=>[_(b,{class:"err_ani"}),_(b,{class:"flex flex-col flex-center"},{default:n((()=>[_(k,{class:"text-weight-b text-white text-size-xl ma-20 text-green"},{default:n((()=>[f("生成失败")])),_:1}),_(j,{width:450,height:80,round:10,label:"返回重新编辑",onClick:t.to_back},null,8,["onClick"])])),_:1})])),_:1})):r("",!0),_(b,{class:"flex flex-row flex-center ma-n10"},{default:n((()=>[_(b,{class:"bear"})])),_:1})])),_:1}),_(y,{color:"white",okColor:"blue",cancelColor:"grey",splitBtn:"",title:"提示",content:"",height:300,okText:"知道了",hideCancel:"",width:600,show:t.preview_show,"onUpdate:show":e[0]||(e[0]=e=>t.preview_show=e),onOk:t.preview},{default:n((()=>[_(b,{class:"flex flex-row flex-center"})])),_:1},8,["show","onOk"])])),_:1})}],["__scopeId","data-v-5b351c81"]]);export{z as default};
