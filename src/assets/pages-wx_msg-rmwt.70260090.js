import{R as e,s as t,o,c as a,w as s,b as l,e as i,t as d,f as r,h as _,j as n,l as h,U as c}from"./index-f5cba0e4.js";import{_ as u}from"./tm-input.4c1b57bc.js";import{r as m}from"./uni-app.es.62a9cda9.js";import{_ as f}from"./tm-button.37a1a22f.js";import{_ as x}from"./tm-sheet.38d3d718.js";import{_ as p}from"./tm-drawer.c7ab85c5.js";import{_ as w}from"./tm-modal.70c18b3d.js";import{_ as g}from"./tm-app.c7c4bc54.js";import{_ as v}from"./_plugin-vue_export-helper.1b428a4d.js";import"./tm-icon.ed97db34.js";import"./tm-text.d010834d.js";import"./useTheme.d1454919.js";import"./tm-translate.1353da0c.js";import"./tm-overlay.d3e45220.js";import"./useWindowInfo.47d82cea.js";const j=v({data:()=>({vk:uni.vk,share_text:"",share_url:"",current_photo_index:0,video:{coverURL:"",realDownloadURL:"",type:"video",videoURL:""},guide_save_video:!1,guide_save_photo:!1,loadding_drawer_show:!1,had_AddedToMyMiniProgram:!1,jiexi_data:{audio:"",cover_url:"",video_url:"",pics:[],type:0},desc:"",images:[],msg_info:{}}),onLoad(e={}){console.log("options",e);let{msg_id:t}=e;t&&this.get_data_by_id(t);let{share_text:o}=e;o&&(this.share_text=o,this.to_jiexi())},onReady(){},onShow(){},onHide(){},onShareAppMessage(e){},methods:{async get_data_by_id(t){let o=await e({url:"https://option.db.apijuhe.cn/findOneById",method:"POST",data:{dbName:"wx_robot",collectionName:"msg_info",dataJson:{_id:t}}});console.log("rq_res",o.data);let{code:a,data:s,msg:l}=o.data;0==a&&(this.msg_info=s,this.share_text=this.msg_info.share_url,this.to_jiexi())},async to_save_photo(){},async to_save_video(){},async to_jiexi(){try{this.loadding_drawer_show=!0;let o=this.share_text.match(/(https?|http):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g);if(!o)return void uni.vk.alert("请输入正确的分享链接!");{this.share_url=o[o.length-1],console.log("请求数据",this.share_url);let a="AOkExoNiYihpnwWj";console.log("alapi_token",a);let s=await e({url:"https://v2.alapi.cn/api/video/url",method:"POST",data:{token:a,url:this.share_url},dataType:"json"});console.log("dataRes",s);let{code:l,data:i}=s.data;200==l&&i?this.jiexi_data=i:t({title:"提示",content:"解析失败,是否重新尝试",success:e=>{e.confirm&&this.to_jiexi()}})}}catch(o){}finally{console.log("解析结束"),setTimeout((()=>{this.loadding_drawer_show=!1}),1e3)}}},watch:{},computed:{}},[["render",function(e,t,v,j,b,y){const k=m(_("tm-input"),u),C=n,T=m(_("tm-button"),f),U=h,R=c,z=m(_("tm-sheet"),x),A=m(_("tm-drawer"),p),L=m(_("tm-modal"),w),S=m(_("tm-app"),g);return o(),a(S,{color:"#1d1c22"},{default:s((()=>[l(C,null,{default:s((()=>[l(k,{modelValue:b.share_text,"onUpdate:modelValue":t[0]||(t[0]=e=>b.share_text=e),height:150,border:1,showClear:"",placeholder:"请点此长按粘贴分享文本",type:"textarea",color:"red",margin:[15,20]},null,8,["modelValue"])])),_:1}),l(C,{class:"flex flex-row flex-center"},{default:s((()=>[l(T,{width:650,height:80,round:10,label:"进行提取",onClick:y.to_jiexi},null,8,["onClick"])])),_:1}),1==b.jiexi_data.type?(o(),a(z,{key:0,round:5,shadow:5},{default:s((()=>[l(C,{class:"felx flex-row flex-center ma-10"},{default:s((()=>[l(U,{class:"text-size-m text-blue"},{default:s((()=>[i(d(b.jiexi_data.title),1)])),_:1})])),_:1}),l(C,{class:"flex flex-row flex-center"},{default:s((()=>[l(R,{src:b.jiexi_data.video_url,style:{width:"630rpx"}},null,8,["src"])])),_:1}),l(C,{class:"flex flex-row flex-center"},{default:s((()=>[l(T,{width:600,height:80,round:10,label:"查看/保存",onClick:t[1]||(t[1]=e=>b.guide_save_video=!0)})])),_:1})])),_:1})):r("",!0),l(A,{ref:"lodding_drawer",placement:"center",show:b.loadding_drawer_show,"onUpdate:show":t[2]||(t[2]=e=>b.loadding_drawer_show=e),height:400,hideHeader:"",overlayClick:!0,disabbleScroll:"",mask:!0,color:"#1d1c22"},{default:s((()=>[l(C,{class:"flex flex-col flex-center ma-20"},{default:s((()=>[l(C,{class:"lds-hourglass"}),l(C,{class:"flex flex-col flex-center"},{default:s((()=>[l(U,{class:"text-weight-b text-white text-size-xl ma-20"},{default:s((()=>[i("正在努力提取中..")])),_:1}),l(U,{class:"text-weight-b text-white text-size-g"},{default:s((()=>[i("请勿切换页面")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),l(L,{color:"white",okColor:"blue",cancelColor:"grey",splitBtn:"",title:"提示",content:"",height:300,okText:"知道了",hideCancel:"",width:600,show:b.guide_save_photo,"onUpdate:show":t[3]||(t[3]=e=>b.guide_save_photo=e),onClose:y.to_save_photo},{default:s((()=>[l(C,{class:"flex flex-row flex-center"},{default:s((()=>[l(U,{class:"text-weight-b text-black"},{default:s((()=>[i("全屏长按可进行保存图片,左右滑动可选择图片")])),_:1})])),_:1})])),_:1},8,["show","onClose"]),l(L,{color:"white",okColor:"blue",cancelColor:"grey",splitBtn:"",title:"提示",content:"",height:400,okText:"知道了",hideCancel:"",width:600,show:b.guide_save_video,"onUpdate:show":t[4]||(t[4]=e=>b.guide_save_video=e),onClose:y.to_save_video},{default:s((()=>[l(C,{class:"flex flex-row flex-center"},{default:s((()=>[l(U,{class:"text-weight-b text-black"},{default:s((()=>[i("全屏播放后进行长按可保存视频,左右滑动可看封面")])),_:1})])),_:1})])),_:1},8,["show","onClose"])])),_:1})}],["__scopeId","data-v-2d2f23ab"]]);export{j as default};
