import{g as e,s as t,a as i,al as o,am as a}from"./index-f5cba0e4.js";async function n(t=(null==mp_ad_obj?void 0:mp_ad_obj.interstitial_ad)){let i=null;console.log("创造插屏广告--------------------"),wx.createInterstitialAd&&(i=wx.createInterstitialAd({adUnitId:t}),i.onLoad((()=>{})),i.onError((e=>{})),i.onClose((()=>{}))),setTimeout((()=>{let t=e("vip_time")||0,o=e("wx_config")||{},a=(new Date).getTime();i&&a>t&&!(null==o?void 0:o.in_ad_review)&&i.show().catch((e=>{console.error(e)}))}),7e3)}let s,c=!1,l=0,d=0,r=0;const _={data:()=>({had_click:!1,nc:0,jump_ad:!1}),onShow(){console.log("mixins onShow-------------------------"),0!=l?(d=(new Date).getTime(),r=parseInt((d-l)/1e3),r>3&&(console.log("完成任务"),this.had_click=!0)):console.log("尚未跳转")},onHide(){console.log("onhide"),c?(l=(new Date).getTime(),console.log("正在跳转广告",l)):console.log("尚未看广告")},onLoad(e={}){if(e.extraData){let t=JSON.parse(decodeURIComponent(e.extraData));this.nc=(null==t?void 0:t.nc)||0,this.jump_ad=t.jump_ad||!1}this.init_ad()},methods:{async to_check_ad(a,n,l=9e4,d=0,r="观看广告即可",_="确定"){let u=(new Date).getTime();this.nc=this.nc||d;let h=e("recent_capture_time")||0;return u-h<7776e6&&(console.log("三个月内",u,h),this.nc=0),console.log("nc----------",d),this.had_click=!1,new Promise((async(h,m)=>{let w=!1,v=e("vip_time")||0,p=e("wx_config"),g=e("need_check_ad_review")||!1,f=e("last_view_rewardad_time")||0;console.log("vip_time",v,"last_view_rewardad_time",f),this.jump_ad||v>u||u-f<l||g&&p.in_ad_review?(w=!0,console.log("下发奖励1",this.jump_ad,v>u,u-f<l,g&&p.in_ad_review),h(w)):(s=setInterval((()=>{this.had_click?(w=!0,i("last_view_rewardad_time",(new Date).getTime()),h(w),clearInterval(s)):console.log("等待中")}),500),t({title:"提示",content:r+n,confirmText:_,success:async u=>{if(u.confirm){this.start_monitor(),this.start_view_ad();let u=await async function(o,a){let n=e("extraData")||{};return new Promise((async(e,s)=>{o.rewardedVideoAd.onClose((t=>{t&&t.isEnded?(console.log("正常播放结束"),o.finish_view_ad=!0):o.finish_view_ad=!1,e(o)})),o.rewardedVideoAd.show().then((()=>{a&&setTimeout((()=>{t({title:"提示",content:(null==n?void 0:n.ad_word)||"你需点击观看本页面内的任意按钮三秒返回即可",showCancel:!1})}),4e3)})).catch((()=>{o.rewardedVideoAd.load().then((()=>o.rewardedVideoAd.show())).catch((t=>{console.log("激励视频 广告显示失败"),o.can_view_ad=!1,o.finish_view_ad=!0,i("last_view_rewardad_time",(new Date).getTime()),e(o)}))}))}))}(a,this.nc);console.log("viewRes",u);let{can_view_ad:m,finish_view_ad:v}=u;this.end_monitor(),await o(200),m?1!=this.nc||this.had_click?0==this.nc&&u.finish_view_ad?(w=!0,console.log("下发奖励3")):0!=this.nc||u.finish_view_ad?(w=!0,console.log("下发奖励4"),console.log("其他情况",this.nc,u.finish_view_ad,this.had_click)):w=!1:(w=!1,r="你尚未完成任务,是否重新观看",_="重新观看",this.to_check_ad(a,n,l,d,r,_)):w=!0,w&&i("last_view_rewardad_time",(new Date).getTime()),clearInterval(s),h(w),await o(200),c=!1}}}))}))},init_ad(){c=!1,l=0,d=0,this.had_click=!1},start_view_ad(){console.log("开始看广告"),c=!0},start_monitor(){},end_monitor(){uni.offUserCaptureScreen(),wx.offScreenRecordingStateChanged()}}};let u={};const h={data:()=>({overdue:!1}),onLoad(t={}){let i=0;u=e("extraData")||{},t.extraData&&(u=JSON.parse(decodeURIComponent(t.extraData)),i=a(null==u?void 0:u.in_time)||0),console.log("check_overdue extraData",u),u.in_time&&(i=a(null==u?void 0:u.in_time)||0),console.log("in_time",i);let o=(new Date).getTime();if(!(Math.abs(o-i)<3e5))return this.overdue=!0,void console.log("过期了----",Math.abs(o-i));this.overdue=!1,console.log("未过期----",Math.abs(o-i))}},m={data:()=>({user_info:{is_vip:!1,capture_num:0,recent_capture_num:0,recent_capture_time:0}}),async onLoad(e={}){let o=(new Date).getTime(),a={};e.extraData&&(a=JSON.parse(decodeURIComponent(e.extraData)));let n={};if(console.log("正在检测useInof",a),(null==a?void 0:a.openid)?(i("openid",a.openid),n=await uni.vk.callFunction({url:"client/gzh/pub/get_openid_info",title:"",data:{openid:null==a?void 0:a.openid},env:"official-account"})):(null==a?void 0:a.authorId)?(i("authorId",a.authorId),n=await uni.vk.callFunction({url:"client/author/pub/get_authorId_info",title:"",data:{authorId:null==a?void 0:a.authorId},env:"qq-robot"})):console.log("无需检测useInof"),0==n.code&&n.data){let{vip_time:e,capture_num:a,recent_capture_num:s,recent_capture_time:c}=n.data;this.user_info.vip_time=e||0,this.user_info.capture_num=a||0,this.user_info.recent_capture_num=s||0,this.user_info.recent_capture_time=c||0,i("vip_time",e),i("capture_num",a),i("recent_capture_num",s),i("recent_capture_time",c),s>=3&&t({title:"提示",content:"你的账号出现异常,请联系客服",showCancel:!1,success:e=>{e.confirm&&uni.exitMiniProgram()}}),e>o?(console.log("会员期间"),this.user_info.is_vip=!0):(console.log("会员过期了2"),this.user_info.is_vip=!1)}}};export{h as a,m as b,_ as c,n as d};
