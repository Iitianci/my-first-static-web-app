import{q as e,v as t,u as l,x as a,a3 as o,y as n,o as r,c as s,w as i,b as u,D as d,G as c,E as p,f,a2 as y,a5 as h,S as m,i as g,j as v}from"./index-f5cba0e4.js";import{_ as x}from"./tm-sheet.38d3d718.js";import{t as w}from"./tm-text.d010834d.js";import{_ as b}from"./tm-icon.ed97db34.js";import{t as _}from"./tm-translate.1353da0c.js";import{c as k}from"./uni-app.es.62a9cda9.js";const I=e({__name:"tm-image",props:{...k,margin:{type:Array,default:()=>[0,0]},padding:{type:Array,default:()=>[0,0]},color:{type:String,default:"white"},transprent:{type:[Boolean,String],default:!0},border:{type:Number,default:0},width:{type:[Number],default:200,required:!0},height:{type:[Number],default:200,required:!0},src:{type:String,default:"",required:!0},errorIcon:{type:String,default:""},errorLabel:{type:String,default:"重新加载"},loadIcon:{type:String,default:""},showLoad:{type:Boolean,default:!0},preview:{type:[Boolean],default:!1},extra:{type:[Boolean],default:!1},extraPosition:{type:String,default:"in"},delete:{type:[Boolean],default:!1},allowDelete:{type:[Boolean],default:!0},model:{type:String,default:"scaleToFill"},unit:{type:String,default:"rpx"},showMenuByLongPress:{type:[Boolean],default:!1}},emits:["load","error","click","delete","close"],setup(e,{emit:k}){var I;const P=e,S=t(null),B=(null==(I=l())?void 0:I.proxy)??null;P.height||P.width||console.error("错误：图片宽度和高度必须设置一个");const L=a((()=>P.width)),j=a((()=>P.height-P.padding[1])),E=a((()=>P.src)),z=t(!0),$=t(!1),C=t(!1),K=t(P.loadIcon||"tmicon-shuaxin"),q=t(P.errorIcon||"tmicon-exclamation-circle");let G=null==B?void 0:B.$parent;for(;G&&"tmImageGroup"!=(null==G?void 0:G.tmImageGroup)&&G;)G=(null==G?void 0:G.$parent)??void 0;const A=o("ImagGrupList",a((()=>[])));function D(e){z.value=!1,k("load",e)}function N(e){console.error("图片加载错:"+P.src,e),$.value=!0,z.value=!1,k("error",e)}function M(e){if(k("click",e),P.preview){let e=A.value.length>0?A.value:[P.src];m({urls:e,current:P.src})}}async function F(){var e,t;C.value=!1,P.allowDelete?(null==(e=S.value)?void 0:e.play)?null==(t=S.value)||t.play():(C.value=!0,k("close",P.src)):k("delete",P.src)}function R(){C.value=!0,k("close",P.src)}function T(){z.value=!0,$.value=!1}return(null==G?void 0:G.pushKey)&&G.pushKey({width:L.value,height:L.value,src:P.src}),n(E,(()=>{z.value=!0,$.value=!1,(null==G?void 0:G.pushKey)&&G.pushKey({width:L.value,height:L.value,src:P.src})})),(e,t)=>{const l=g,a=v;return C.value?f("",!0):(r(),s(a,{key:0,style:p([{margin:P.margin[0]+P.unit+" "+(P.margin[1]||P.margin[0])+P.unit}])},{default:i((()=>[u(_,{width:d(L)+2*P.padding[0]+P.unit,onEnd:R,ref_key:"aniplay",ref:S,autoPlay:!1,name:"zoom",reverse:""},{default:i((()=>[u(x,{margin:[0],color:P.color,transprent:P.transprent,round:P.round,border:P.border,padding:[P.padding[0],0],class:c(["round-"+P.round]),width:d(L)-2*P.padding[0],unit:P.unit,height:d(j)-2*P.padding[0]},{default:i((()=>[u(a,{class:c([`pb-${P.padding[1]}`,"flex flex-col flex-col-center-center","relative"])},{default:i((()=>[$.value?f("",!0):(r(),s(l,{key:0,onLoad:D,onError:N,"show-menu-by-longpress":P.showMenuByLongPress,onClick:M,class:c(["round-"+P.round,z.value?"opacity-0":""]),src:d(E),style:p([{width:d(L)+P.unit,height:d(j)+P.unit}]),mode:P.model},null,8,["show-menu-by-longpress","class","src","style","mode"])),z.value&&!$.value?(r(),s(a,{key:1,style:p([{width:d(L)+P.unit,height:d(j)+10+P.unit}]),class:"flex flex-center opacity-3 absolute l-0 t-0"},{default:i((()=>[y(e.$slots,"load",{},(()=>[P.showLoad?(r(),s(b,{key:0,"font-size":26,spin:"",name:K.value},null,8,["name"])):f("",!0)]))])),_:3},8,["style"])):f("",!0),!z.value&&$.value?(r(),s(a,{key:2,style:p([{width:d(L)+P.unit,height:d(j)+P.unit}]),class:"flex flex-col flex-center opacity-5 absolute l-0 t-0"},{default:i((()=>[y(e.$slots,"error",{},(()=>[u(a,{onClick:T},{default:i((()=>[u(b,{userInteractionEnabled:!1,name:q.value},null,8,["name"]),u(w,{userInteractionEnabled:!1,_class:"pt-10","font-size":26,label:P.errorLabel},null,8,["label"])])),_:1})]))])),_:3},8,["style"])):f("",!0),P.extra?(r(),s(a,{key:3,eventPenetrationEnabled:!0,class:c(["in"==P.extraPosition?"absolute l-0 b-0 zIndex-5 ":"","flex flex-col flex-col-bottom-start "]),style:p([P.extra&&"in"==P.extraPosition?{height:d(j)+P.unit,width:d(L)+P.unit}:"",P.extra&&"out"==P.extraPosition?{width:d(L)+P.unit}:""])},{default:i((()=>[u(a,{onClick:h(M,["stop"]),class:c(["flex flex-col flex-col-bottom-start flex-1"]),style:p([P.extra&&"in"==P.extraPosition?{height:d(j)+P.unit,width:d(L)+P.unit}:"",P.extra&&"out"==P.extraPosition?{width:d(L)+P.unit}:""])},{default:i((()=>[y(e.$slots,"extra")])),_:3},8,["onClick","style"])])),_:3},8,["class","style"])):f("",!0),P.delete?(r(),s(a,{key:4,class:"absolute r-4 t-4 flex flex-col flex-col-center-end zIndex-10",style:p([P.delete?{width:d(L)+P.unit}:""])},{default:i((()=>[u(b,{onClick:F,color:"red",name:"tmicon-times-circle-fill"})])),_:1},8,["style"])):f("",!0)])),_:3},8,["class"])])),_:3},8,["color","transprent","round","border","padding","class","width","unit","height"])])),_:3},8,["width"])])),_:3},8,["style"]))}}});export{I as _};
