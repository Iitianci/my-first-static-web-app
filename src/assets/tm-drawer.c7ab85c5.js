import{q as e,v as t,u as l,x as a,ae as o,y as n,A as u,z as r,o as i,c as s,w as f,b as c,a2 as d,D as p,aa as v,a5 as m,E as y,G as h,f as x,C as w,j as k}from"./index-f5cba0e4.js";import{t as b}from"./tm-translate.1353da0c.js";import{t as g}from"./tm-text.d010834d.js";import{_}from"./tm-icon.ed97db34.js";import{t as C}from"./tm-overlay.d3e45220.js";import{c as S,u as z,e as N,a as B,b as j,d as T}from"./uni-app.es.62a9cda9.js";import{u as H}from"./useWindowInfo.47d82cea.js";import{_ as I}from"./_plugin-vue_export-helper.1b428a4d.js";const O=I(e({__name:"tm-drawer",props:{...S,mask:{type:[Boolean,String],default:!0},placement:{type:String,default:"bottom"},show:{type:[Boolean],default:!1},width:{type:Number,default:500},height:{type:Number,default:600},round:{type:Number,default:10},duration:{type:Number,default:300},overlayClick:{type:Boolean,default:!0},transprent:{type:[Boolean,String],default:!1},closeable:{type:[Boolean,String],default:!1},color:{type:String,default:"white"},title:[String],okText:{type:[String],default:"完成"},okColor:{type:[String],default:"primary"},okLoading:{type:[Boolean,String],default:!1},cancelText:{type:[String],default:"取消"},hideCancel:{type:[Boolean,String],default:!1},hideHeader:{type:[Boolean,String],default:!1},disabled:{type:Boolean,default:!1},zIndex:{type:[Number,String],default:401},unit:{type:String,default:"rpx"},disabbleScroll:{type:Boolean,default:!1},inContent:{type:Boolean,default:!1},footHeight:{type:Number,default:0},teleport:{type:Boolean,default:!0},beforeOpen:{type:Function,default:null},beforeOk:{type:Function,default:null},beforeCance:{type:Function,default:null}},emits:["click","open","close","update:show","ok","cancel"],setup(e,{expose:S,emit:I}){var O;const $=e,A=t(null),F=t(null),L=z();null==(O=l())||O.proxy;const E=H(),U=a((()=>L.tmStore)),Y=a((()=>N($))),q=a((()=>B($))),D=a((()=>j($,U.value))),G=a((()=>T($,D.value,U.value))),J=t(!0),K=t(0);let P=NaN,R=!1;o();let W=t($.show);const M=t(!1);function Q(e,t=500,l=!1){isNaN(P)||clearTimeout(P),l?(P=setTimeout((()=>{P=NaN}),t),"function"==typeof e&&e()):P=setTimeout((()=>{"function"==typeof e&&e()}),t)}K.value=uni.$tm.u.getUid(4),W.value&&(J.value=!1),n((()=>$.show),(e=>{var t;e?J.value=!0:(J.value=!1,null==(t=F.value)||t.close()),W.value!==$.show&&u((()=>{var e;null==(e=A.value)||e.play(),M.value=!0})),W.value=$.show})),r((()=>{W.value&&pe()}));const V=a((()=>$.okLoading)),X=t(!1),Z=a((()=>"left"==te.value?"round-r-"+$.round:"right"==te.value?"round-l-"+$.round:"up"==te.value?"round-b-"+$.round:"down"==te.value?"round-t-"+$.round:"zoom"==te.value?"round-"+$.round:void 0)),ee=a((()=>"zoom"!=te.value?J.value:!J.value)),te=a((()=>"center"==$.placement?"zoom":"top"==$.placement?"up":"bottom"==$.placement?"down":$.placement)),le=a((()=>"zoom"==te.value||"left"==$.placement||"right"==$.placement?$.width+$.unit:E.width+"px")),ae=a((()=>"top"==$.placement||"bottom"==$.placement||"zoom"==te.value?$.height+0+$.unit:E.height+"px")),oe=a((()=>{let e=$.hideHeader?0:44,t=uni.$tm.u.topx($.footHeight);if("top"==$.placement||"bottom"==$.placement||"zoom"==te.value){let l=$.height;return"rpx"==$.unit&&(l=w($.height)),l-e-t+"px"}return E.height-e-t+"px"})),ne=a((()=>"down"==te.value?"flex-col-bottom-center":"up"==te.value?"flex-top-custom":"left"==te.value?"flex-row-top-start":"right"==te.value?"flex-row-bottom-start":"zoom"==te.value?"flex-center":void 0));async function ue(){let e=!0;if("function"!=typeof $.beforeCance||(X.value=!0,e=await $.beforeCance(),"function"==typeof e&&(e=await e()),X.value=!1,e))return e}function re(){!async function(){if("function"==typeof $.beforeOpen){X.value=!0;let e=await $.beforeOpen();"function"==typeof e&&(e=await e()),X.value=!1}}(),W.value=!0,I("open"),I("update:show",!0)}function ie(){u((()=>{W.value=!1,I("close"),I("update:show",!1)}))}async function se(e){!$.overlayClick||$.disabled||!F.value||X.value||M.value||(I("click",e),await ue()&&(J.value=!1,function(e,t=500,l=!0){l?R||(R=!0,"function"==typeof e&&e(),setTimeout((()=>{R=!1}),t)):R||(R=!0,setTimeout((()=>{R=!1,"function"==typeof e&&e()}),t))}((async()=>{var e,t;I("cancel"),null==(e=F.value)||e.close(),null==(t=A.value)||t.play()}),$.duration+80,!0)))}function fe(){M.value=!1}async function ce(){$.disabled||X.value||await async function(){let e=!0;if("function"!=typeof $.beforeOk||(X.value=!0,e=await $.beforeOk(),"function"==typeof e&&(e=await e()),X.value=!1,e))return e}()&&(J.value=!1,Q((()=>{var e,t;I("ok"),null==(e=F.value)||e.close(),null==(t=A.value)||t.play()}),500,!0))}async function de(){$.disabled||X.value||await ue()&&(J.value=!1,Q((()=>{var e,t;I("cancel"),null==(e=F.value)||e.close(),null==(t=A.value)||t.play()}),500,!0))}function pe(){J.value=!0,W.value=!0,u((()=>{var e;null==(e=A.value)||e.play()}))}return S({close:function(){var e,t;J.value=!1,null==(e=F.value)||e.close(),null==(t=A.value)||t.play()},open:pe}),(t,l)=>{const a=k;return i(),s(a,null,{default:f((()=>[c(a,{onClick:pe},{default:f((()=>[d(t.$slots,"trigger",{},void 0,!0)])),_:3}),c(C,{inContent:$.inContent,ref_key:"overlayAni",ref:F,duration:$.duration+80,onOpen:re,onClose:ie,zIndex:$.zIndex,transprent:!$.mask,onClick:se,align:p(ne),teleport:$.teleport,overlayClick:!1,show:p(W),"onUpdate:show":l[1]||(l[1]=e=>v(W)?W.value=e:W=e)},{default:f((()=>[c(b,{reverse:p(ee),width:p(le),height:p(ae),ref_key:"drawerANI",ref:A,"auto-play":!1,name:p(te),duration:$.duration+80,onEnd:fe},{default:f((()=>[c(a,{onClick:l[0]||(l[0]=m((e=>e.stopPropagation()),["stop"])),style:y([{width:p(le),height:p(ae)},$.transprent?"":p(G).borderCss,$.transprent?"":p(G).backgroundColorCss,$.transprent?"":p(G).shadowColor,p(Y)]),class:h([p(Z),"flex flex-col overflow ",p(q)])},{default:f((()=>[$.closeable||$.hideHeader?x("",!0):(i(),s(a,{key:0,class:"flex flex-row flex-row-center-center flex-between px-24",style:{height:"44px"}},{default:f((()=>[c(a,{class:"flex-4 flex-shrink"},{default:f((()=>[$.hideCancel||X.value||p(V)?x("",!0):(i(),s(g,{key:0,onClick:de,label:$.cancelText},null,8,["label"]))])),_:1}),c(a,{class:"flex-8 px-32 flex-center"},{default:f((()=>[d(t.$slots,"title",{},(()=>[c(g,{_class:"text-overflow-1 opacity-7",label:$.title},null,8,["label"])]),!0)])),_:3}),c(a,{class:"flex-4 flex-shrink flex-row flex-row-center-end"},{default:f((()=>[p(V)||X.value?x("",!0):(i(),s(g,{key:0,color:e.okColor,onClick:ce,dark:$.dark,label:$.okText},null,8,["color","dark","label"])),p(V)||X.value?(i(),s(_,{key:1,color:e.okColor,spin:p(V)||X.value,dark:p(D),_class:!0!==p(D)?"opacity-4":"",fontSize:24,name:p(V)||X.value?"tmicon-shuaxin":"tmicon-times-circle-fill"},null,8,["color","spin","dark","_class","name"])):x("",!0)])),_:1})])),_:3})),$.closeable&&!$.hideHeader?(i(),s(a,{key:1,class:"flex flex-row flex-row-center-center flex-between px-24",style:{height:"44px"}},{default:f((()=>[c(a,{class:"flex-9 pr-32"},{default:f((()=>[d(t.$slots,"title",{},(()=>[c(g,{_class:"text-overflow-1 opacity-7",dark:$.dark,label:$.title},null,8,["dark","label"])]),!0)])),_:3}),c(a,{class:"flex-3 flex-shrink flex-row flex-row-center-end"},{default:f((()=>[c(_,{onClick:de,dark:$.dark,_class:!0!==p(D)?"opacity-3":"",fontSize:36,name:"tmicon-times-circle-fill"},null,8,["dark","_class"])])),_:1})])),_:3})):x("",!0),c(a,{style:y({overflowY:$.disabbleScroll?"normal":"auto",height:p(oe)})},{default:f((()=>[d(t.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),d(t.$slots,"foot",{},(()=>[$.footHeight>0?(i(),s(a,{key:0,class:"flex"})):x("",!0)]),!0)])),_:3},8,["style","class"])])),_:3},8,["reverse","width","height","name","duration"])])),_:3},8,["inContent","duration","zIndex","transprent","align","teleport","show"])])),_:3})}}}),[["__scopeId","data-v-c6195394"]]);export{O as _};
