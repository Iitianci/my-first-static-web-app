import{_ as t}from"./tm-message.42d12b93.js";import{a as e,P as i,n as s,o as a,c as o,w as l,j as n,b as _,d as c,r,F as h,h as d,f as u,e as m,t as g,p as f,i as p,l as x,S as y,_ as w,W as v,k as b}from"./index-f5cba0e4.js";import{r as k}from"./uni-app.es.62a9cda9.js";import{_ as j}from"./tm-tabs.492def44.js";import{_ as T}from"./tm-skeleton-line.9799a71e.js";import{_ as C}from"./tm-sheet.38d3d718.js";import{_ as $}from"./tm-icon.ed97db34.js";import{_ as z}from"./tm-app.c7c4bc54.js";import{b as I,g as S}from"./api.f04a1197.js";import{t as N}from"./tm-text.d010834d.js";import{_ as X}from"./_plugin-vue_export-helper.1b428a4d.js";import"./useWindowInfo.47d82cea.js";import"./tm-badge.vue_vue_type_script_setup_true_lang.38983ab0.js";import"./useTheme.d1454919.js";const Y=X({components:{galleryCard:X({name:"wallpaper-card",emits:["change_full_status","to_change_choose"],props:{first_loding:{type:String,default:""},action:{type:String,default:"view"},material_item:{type:Object,default:{}},index:{type:Number,default:66},avatar:{type:String,default:""},info:{type:String,default:"此人很懒,没有介绍"},nickname:{type:String,default:"好看的头像"}},data:()=>({vk:uni.vk,is_full:!1,current_item:{},current_index:0}),computed:{},methods:{to_change_choose(t){let{card_cloud_url:a,avatar_cloud_url:o}=t;e("img_list",[a,o]);let l={need_jump:!1,need_check_ad_review:!0,in_time:i((new Date).getTime()),item:{type_text:"gallery"}};s({url:`/pages/matetial/detail?extraData=${encodeURIComponent(JSON.stringify(l))}`})},change_full_status(t){this.$emit("change_full_status",t)},async click_down(){console.log("下载",this.current_index);let t=this.material_item.item_list[this.current_index].avatar_cloud_url;this.$emit("click_down",{down_url:t,down_type:"img"});let e=this.material_item.item_list[this.current_index].card_cloud_url;this.$emit("click_down",{down_url:e,down_type:"img"})},to_full_show(t,e){console.log("index",e),this.current_index=e,this.current_item=t,this.is_full=!0,this.change_full_status(this.is_full)},async next_item(){if(this.current_index>=this.material_item.item_list.length-1)return console.log("no more"),void uni.vk.toast("没有更多了","none");this.current_index++,this.current_item=this.material_item.item_list[this.current_index]},before_item(){if(this.current_index<=0)return console.log("is the first"),void uni.vk.toast("已经是第一个","none");this.current_index--,this.current_item=this.material_item.item_list[this.current_index]},start(t){this.clientX=t.changedTouches[0].clientX,this.clientY=t.changedTouches[0].clientY},async end(t){const e=t.changedTouches[0].clientX-this.clientX,i=t.changedTouches[0].clientY-this.clientY;i>50||e>50?(console.log("下滑或左划"),this.before_item()):(i<-50||e<-50)&&(console.log("上滑或右划"),this.next_item())},exit_full(){this.is_full=!1,this.change_full_status(this.is_full)}}},[["render",function(e,i,s,y,w,v){const b=k(d("tm-message"),t),j=k(d("tm-skeleton-line"),T),$=n,z=k(d("tm-sheet"),C),I=f,S=p,X=k(d("tm-text"),N),Y=x;return a(),o($,null,{default:l((()=>[_(b,{ref:"toast"},null,512),_($,null,{default:l((()=>[s.first_loding?(a(),c(h,{key:0},r(20,((t,e)=>_($,null,{default:l((()=>[_(z,{_class:"shadow-1 round-5",class:"round-5",padding:[20,30],margin:[25,10]},{default:l((()=>[_($,null,{default:l((()=>[_(j,{height:300,width:600})])),_:1}),_($,{class:"mt-2"},{default:l((()=>[_(j,{height:30,width:600})])),_:1}),_($,{class:"mt-2"},{default:l((()=>[_(j,{height:30,width:600})])),_:1})])),_:1})])),_:1}))),64)):(a(),o($,{key:1},{default:l((()=>[(a(!0),c(h,null,r(s.material_item.item_list,((t,e)=>(a(),o($,null,{default:l((()=>[w.vk.getVuex("$app.mp_ad_obj.banner")&&e%8==1?(a(),o($,{key:0},{default:l((()=>[_(I,{"unit-id":w.vk.getVuex("$app.mp_ad_obj.banner")},null,8,["unit-id"])])),_:1})):u("",!0),(a(),o(z,{round:3,shadow:5,key:e},{default:l((()=>[_($,{class:"flex flex-col flex-center"},{default:l((()=>[_($,{style:{"margin-bottom":"-100rpx"},onClick:e=>v.to_change_choose(t)},{default:l((()=>[_(S,{src:t.card_cloud_url+"?x-oss-process=image/resize,w_500,m_lfit",mode:"aspectFill",style:{width:"650rpx",height:"300rpx"}},null,8,["src"])])),_:2},1032,["onClick"]),_($,{onClick:e=>v.to_change_choose(t)},{default:l((()=>[_(S,{src:t.avatar_cloud_url+"?x-oss-process=image/resize,w_150,m_lfit",mode:"aspectFill",style:{width:"180rpx",height:"180rpx"},class:"round-25"},null,8,["src"])])),_:2},1032,["onClick"]),_($,null,{default:l((()=>[_(X,{label:t.name},null,8,["label"])])),_:2},1024),_($,null,{default:l((()=>[_(Y,{class:"text-size-m text-grey"},{default:l((()=>[m(g(t.memo),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024))])),_:2},1024)))),256))])),_:1}))])),_:1})])),_:1})}],["__scopeId","data-v-20571296"]])},data:()=>({dbName:"gallery",vk:uni.vk,is_fixed:!1,choose_list_drawer_show:!1,first_loding:!0,action:"view",up_tips_show:!0,choose_show:!1,hideBtn:!1,is_full:!1,is_loading:!1,active_tabs_index:0,current_cid:1,current_index:1,windowHeight:"",current_id:"",current_zh_type:"全部",current_item:{},had_choose_list:[],category_list:[{cid:"1",title:"动漫",item_list:[]},{cid:"2",title:"古风",item_list:[]},{cid:"3",title:"情侣",item_list:[]},{cid:"4",title:"男生",item_list:[]},{cid:"5",title:"女生",item_list:[]},{cid:"6",title:"明星",item_list:[]},{cid:"7",title:"可爱",item_list:[]},{cid:"8",title:"精选",item_list:[]}],scrollTop:0,show_to_top:!1,nickname_list:[],avatar_list:[],can_max_choose:100}),computed:{},onPageScroll(t){t.scrollTop>200?this.show_to_top=!0:this.show_to_top=!1},onReachBottom(){this.get_list_data()},methods:{finish_download(t){console.log("下载完成",t)},async click_down(t){console.log("父节点click_down",t),this.$refs.down_matetial.click_down(t)},async open_choose_list(){this.$refs.choose_list_popup.open("right")},previewImage(t){console.log("预览图片",t),y({current:t,urls:[t],loop:!0,longPressActions:{itemList:[],success:function(t){console.log("选中了第"+(t.tapIndex+1)+"个按钮,第"+(t.index+1)+"张图片")},fail:function(t){console.log(t.errMsg)}}})},async finish_choose(){if(0==this.had_choose_list.length)return;let t=await uni.vk.callFunction({url:"client/select_material/kh/add",title:"",data:{dbName:this.dbName,type:"gallery",item_list:this.had_choose_list}});0==t.code?(console.log("选材成功!"),this.$refs.toast.show({text:"选材成功!",model:"success",mask:!0,wait:2e3}),w({url:"/pages/matetial/detail?guide_show=true&share_code="+t.share_code})):this.$refs.toast.show({text:t.msg,model:"error",mask:!0,wait:2e3})},unchoose_all(){uni.vk.toast("取消中..","none",2e3);let t=this.category_list[this.active_tabs_index].item_list.length;for(let e=0;e<t;e++){let t=this.category_list[this.active_tabs_index].item_list[e];t.had_choose&&this.to_change_choose({item:t,index:e})}uni.vk.toast("取消成功","none",2e3)},choose_all(){uni.vk.toast("正在选择中..","none",2e3);let t=this.category_list[this.active_tabs_index].item_list.length,e=this.can_max_choose-this.had_choose_list.length,i=t>e?e:t,s=0;for(let a=0;a<t;a++){let t=this.category_list[this.active_tabs_index].item_list[a];if(!t.had_choose&&(this.to_change_choose({item:t,index:a}),s++,s>=i))return}uni.vk.toast("选择成功","none",1e3)},to_change_choose(t){let{item:e,index:i}=t;console.log("item",e);let s=!this.category_list[this.active_tabs_index].item_list[i].had_choose;if(this.category_list[this.active_tabs_index].item_list[i].had_choose=s,s){if(this.had_choose_list.length>=this.can_max_choose)return void console.log("超过单次最大选择数量了");this.had_choose_list.push(e)}else for(let a=0;a<this.had_choose_list.length;a++)if(this.had_choose_list[a]._id==e._id){this.had_choose_list.splice(a,1);break}},rm_choose(t,e){this.had_choose_list.splice(t,1);for(let i=0;i<this.category_list[this.active_tabs_index].item_list.length;i++)if(this.category_list[this.active_tabs_index].item_list[i]._id==e){this.category_list[this.active_tabs_index].item_list[i].had_choose=!1;break}},async tab_change(t){console.log("tab_change",t),this.active_tabs_index=t,this.current_zh_type=this.category_list[this.active_tabs_index].zh_type,0==this.category_list[this.active_tabs_index].item_list.length&&(this.first_loding=!0,await this.get_list_data(),setTimeout((()=>{this.first_loding=!1}),500))},async choose_platform(t){console.log("e",t);let{index:e,data:i}=t;"QQ"==i?console.log("打开QQ小程序"):"微信"==i&&console.log("打开微信小程序")},async to_get_avatar_byId(t){if(t){let e=await I("avatar",t);0==e.code&&(this.avatar_list=[e.data,...this.avatar_list])}},to_top(){v({scrollTop:0,duration:300})},async tabs_change(t){this.current_cid=parseInt(this.category_list[t].cid),0==this.category_list[t].item_list.length&&this.get_list_data()},async get_list_data(){if(this.is_loadding)return;this.is_loadding=!0;let t={};"全部"!=this.current_zh_type&&(t={zh_type:this.current_zh_type});let e=await S(this.dbName,t,1,30);if(console.log("res",e),0==e.code&&null!=e.data){let t=e.data;for(let e=0;e<t.length;e++)t[e].had_choose=!1;console.log("img_data",t),this.category_list[this.active_tabs_index].item_list=[...this.category_list[this.active_tabs_index].item_list,...t]}else if(0==e.code&&null==e.data)return;this.is_loadding=!1},async next_item(){if(this.current_index>=this.avatar_list.length-1)return console.log("no more"),void this.$refs.toast.show({text:"没有更多了",model:"info",mask:!0,wait:2e3});this.current_index++,this.current_item=this.avatar_list[this.current_index],this.avatar_list.length-this.current_index<=20&&(console.log("去加载下一页"),await this.get_list_data())},before_item(){if(this.current_index<=0)return console.log("is the first"),void this.$refs.toast.show({text:"已经是第一个了",model:"info",mask:!0,wait:2e3});this.current_index--,this.current_item=this.avatar_list[this.current_index]},start(t){this.clientX=t.changedTouches[0].clientX,this.clientY=t.changedTouches[0].clientY},async end(t){const e=t.changedTouches[0].clientX-this.clientX,i=t.changedTouches[0].clientY-this.clientY;i>50||e>50?(console.log("下滑或左划"),this.before_item()):(i<-50||e<-50)&&(console.log("上滑或右划"),this.next_item())},exit_full(){this.is_full=!1}},async onLoad(t={}){this.windowHeight=uni.vk.getVuex("$sys.sys.windowHeight")*uni.vk.getVuex("$sys.sys.devicePixelRatio")+"rpx",this.first_loding=!0,this.action=t.action||"view",this.active_tabs_index=parseInt(t.active_tabs_index)||0,this.current_cid=this.active_tabs_index+1||1},async onReady(){await this.get_list_data(),setTimeout((()=>{this.first_loding=!1}),200),"choose"==this.action?this.is_fixed=!0:this.is_fixed=!1}},[["render",function(e,i,s,g,f,p){const x=k(d("tm-message"),t),y=k(d("tm-tabs"),j),w=n,v=k(d("tm-skeleton-line"),T),I=k(d("tm-sheet"),C),S=b("gallery-card"),N=k(d("tm-icon"),$),X=k(d("tm-app"),z);return a(),o(X,null,{default:l((()=>[_(x,{ref:"toast"},null,512),_(w,{class:"fixed zIndex-10"},{default:l((()=>[_(y,{list:f.category_list,border:1,width:750,height:300,"default-name":f.active_tabs_index,round:2,color:"grey",activeName:f.active_tabs_index,itemModel:"line",text:"",activeFontColor:"primary",unSelectedColor:"grey-darken-2",onChange:p.tab_change},null,8,["list","default-name","activeName","onChange"])])),_:1}),_(w,{style:{"margin-top":"100rpx"}},{default:l((()=>[f.first_loding?(a(),c(h,{key:0},r(20,((t,e)=>_(w,null,{default:l((()=>[_(I,{_class:"shadow-1 round-5",class:"round-5",padding:[20,30],margin:[25,10]},{default:l((()=>[_(w,null,{default:l((()=>[_(v,{height:300,width:600})])),_:1}),_(w,{class:"mt-2"},{default:l((()=>[_(v,{height:30,width:600})])),_:1}),_(w,{class:"mt-2"},{default:l((()=>[_(v,{height:30,width:600})])),_:1})])),_:1})])),_:1}))),64)):(a(),o(w,{key:1},{default:l((()=>[_(S,{material_item:f.category_list[f.active_tabs_index],first_loding:f.first_loding,onClick_down:p.click_down,onTo_change_choose:p.to_change_choose,action:f.action},null,8,["material_item","first_loding","onClick_down","onTo_change_choose","action"])])),_:1}))])),_:1}),f.is_loading?(a(),o(w,{key:0,style:{"margin-bottom":"250rpx"}},{default:l((()=>[m("> "),_(N,{spin:"","font-size":50,name:"tmicon-loading",color:"blue"})])),_:1})):u("",!0),f.show_to_top?(a(),o(w,{key:1,class:"to_top border-1-bk shadow-10",onClick:p.to_top},{default:l((()=>[_(N,{"font-size":45,shadow:10,name:"tmicon-arrow-alt-from-botto",color:"black"})])),_:1},8,["onClick"])):u("",!0)])),_:1})}],["__scopeId","data-v-5feb7780"]]);export{Y as default};
