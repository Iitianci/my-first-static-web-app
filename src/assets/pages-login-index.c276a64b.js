import{_ as e}from"./tm-notification.f2273359.js";import{o as t,c as n,w as i,d as l,F as o,r as a,G as s,E as r,b as c,e as u,t as d,l as _,j as m,a as p,Y as f,g,H as h,J as x,s as y,f as b,h as v,i as k,a8 as w,a9 as C}from"./index-f5cba0e4.js";import{r as I}from"./uni-app.es.62a9cda9.js";import{_ as T}from"./tm-message.42d12b93.js";import{_ as V}from"./tm-sheet.38d3d718.js";import{t as j}from"./tm-text.d010834d.js";import{_ as z}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as B}from"./tm-button.37a1a22f.js";import{_ as $}from"./tm-badge.vue_vue_type_script_setup_true_lang.38983ab0.js";import{_ as F}from"./tm-divider.vue_vue_type_script_setup_true_lang.9ff71b57.js";import{_ as U}from"./tm-input.4c1b57bc.js";import{_ as L}from"./tm-image.vue_vue_type_script_setup_true_lang.e60a99a6.js";import"./tm-icon.ed97db34.js";import"./useWindowInfo.47d82cea.js";import"./useTheme.d1454919.js";import"./tm-translate.1353da0c.js";const S=z({name:"UniSegmentedControl",emits:["clickItem"],props:{current:{type:Number,default:0},values:{type:Array,default:()=>[]},activeColor:{type:String,default:"#2979FF"},styleType:{type:String,default:"button"}},data:()=>({currentIndex:0}),watch:{current(e){e!==this.currentIndex&&(this.currentIndex=e)}},created(){this.currentIndex=this.current},methods:{_onClick(e){this.currentIndex!==e&&(this.currentIndex=e,this.$emit("clickItem",{currentIndex:e}))}}},[["render",function(e,p,f,g,h,x){const y=_,b=m;return t(),n(b,{class:s([["text"===f.styleType?"segmented-control--text":"segmented-control--button"],"segmented-control"]),style:r({borderColor:"text"===f.styleType?"":f.activeColor})},{default:i((()=>[(t(!0),l(o,null,a(f.values,((e,l)=>(t(),n(b,{class:s([["text"===f.styleType?"":"segmented-control__item--button",l===h.currentIndex&&"button"===f.styleType?"segmented-control__item--button--active":"",0===l&&"button"===f.styleType?"segmented-control__item--button--first":"",l===f.values.length-1&&"button"===f.styleType?"segmented-control__item--button--last":""],"segmented-control__item"]),key:l,style:r({backgroundColor:l===h.currentIndex&&"button"===f.styleType?f.activeColor:"",borderColor:l===h.currentIndex&&"text"===f.styleType||"button"===f.styleType?f.activeColor:"transparent"}),onClick:e=>x._onClick(l)},{default:i((()=>[c(b,null,{default:i((()=>[c(y,{style:r({color:l===h.currentIndex?"text"===f.styleType?f.activeColor:"#fff":"text"===f.styleType?"#000":f.activeColor}),class:s(["segmented-control__text","text"===f.styleType&&l===h.currentIndex?"segmented-control__item--text":""])},{default:i((()=>[u(d(e),1)])),_:2},1032,["style","class"])])),_:2},1024)])),_:2},1032,["class","style","onClick"])))),128))])),_:1},8,["class","style"])}],["__scopeId","data-v-cd8f471b"]]);var D="";const P=z({data:()=>({if_agree:!1,range:[{value:0,text:""}],username:"",password:"",use_qr_login:!1,login_qr_code:"",keyborad_show:!1,had_read_tips:!1,login_tips_show:!1,comfir_password:"",verifica_code:"",verifica_text:"获取验证码",captchaBase64:"",captcha:"",scene:"login",count_down_num:60,invite_code:"",mobile:"",complete_info_show:!1,nickName:"",avatarUrl:"",sign:"",action:"",login_type_index:0,login_type_list:["一键登录","短信登录","密码登录"],encryptedKey:""}),computed:{test:()=>1234},async onLoad(e={}){let{action:t,sign:n}=e;this.action=t||"",this.sign=n||""},onShow(){this.init_count_down_num(),this.invite_code=uni.vk.getVuex("$app.inviteCode")},methods:{to_path(e){uni.vk.navigateTo({url:e,fail:e=>{console.log("err",e)}})},change_agree(){this.if_agree=!this.if_agree},async createCaptcha(){let e=await uni.vk.callFunction({url:"client/captcha/pub/createCaptcha",title:"请求中...",data:{mobile:this.mobile,captcha:this.captcha,scene:this.scene,background:"#ffffff",fontSize:60,noise:3,height:60,mathExpr:!0}}),{code:t,msg:n,captchaBase64:i}=e;0==t&&(this.captchaBase64=i)},loginByUniverify:async()=>(uni.vk.alert("一键登录只能在APP操作,请切换其他登录方式"),!1),async verifyCaptcah(){return await uni.vk.callFunction({url:"client/captcha/pub/verifyCaptcah",title:"请求中...",data:{mobile:this.mobile,captcha:this.captcha,scene:this.scene}})},more_help(){uni.vk.alert("请联系客服需求帮助")},forget_password(){uni.vk.alert("请在短信登录之后,再重置密码")},async refresh_login_status(){let e=uni.vk.getVuex("$app.login_key"),{action:t,sign:n}=e,i=await uni.vk.callFunction({url:"client/login_token/pub/get",title:"",data:{action:t,sign:n}});if(0==i.code)if(i.data){let{uni_id_token:e,uni_id_token_expired:t,userInfo:n}=i.data;e?(uni.vk.alert("登录成功"),uni.vk.setVuex("$user.userInfo",n),p("uni_id_token",e),p("uni_id_token_expired",t),f({delta:1})):uni.vk.alert("你尚未完成登录验证")}else uni.vk.alert("登录失败")},async change_login_method(e){this.login_type_index!==e.currentIndex&&(this.login_type_index=e.currentIndex)},init_count_down_num(){clearInterval(D);let e=g("send_code_time")||0,t=(new Date).getTime();if(t-e>6e4)this.verifica_text="获取验证码",this.count_down_num=60;else{let n=parseInt(60-(t-e)/1e3);this.start_count_down(n)}},start_count_down(e=60){console.log("start_count_down"),this.count_down_num=e;let t=(new Date).getTime();D=setInterval((()=>{this.count_down_num--,console.log("剩"+this.count_down_num+"秒"),this.verifica_text="剩"+this.count_down_num+"秒",p("send_code_time",t),this.count_down_num<=0&&(this.verifica_text="获取验证码",clearInterval(D),this.count_down_num=60)}),1e3)},cancel_once_login(){this.had_read_tips=!0},confirm_once_login(){this.if_agree?this.had_read_tips=!0:uni.vk.alert("请选阅读并同意协议")},one_get_userInfo(){},async update_login_token(e,t,n){await uni.vk.callFunction({url:"client/login_token/pub/set",title:"",data:{sign:this.sign,action:this.action,uni_id_token:e,uni_id_token_expired:t,userInfo:n}})},async loginByWeixinPhoneNumber(e){if(!this.if_agree)return void uni.vk.alert("请选阅读并同意协议");let{encryptedData:t,iv:n}=e.detail;if(!t||!n)return!1;uni.vk.userCenter.loginByWeixinPhoneNumber({data:{encryptedData:t,iv:n,encryptedKey:this.encryptedKey},success:async e=>{await this.login_success()}})},async login_success(){if(console.log("action",this.action),"third_login"==this.action){let e=g("uni_id_token"),t=g("uni_id_token_expired"),n=uni.vk.getVuex("$user.userInfo");await this.update_login_token(e,t,n)}setTimeout((()=>{f({delta:1})}),1e3)},async login_by_wechat(){if(!this.if_agree)return void uni.vk.alert("请选阅读并同意协议");console.log("微信登录"),this.$refs.toast.show({model:"load",text:"登录中...",mask:!0});let e=uni.vk.getVuex("$app.config.mp_appid"),t=uni.vk.getVuex("$app.inviteCode")||"";uni.vk.userCenter.loginByWeixin({data:{type:"",appid:e,inviteCode:t},loading:!1,success:async e=>{await this.login_success()}})},login_by_password(){this.if_agree?this.mobile&&this.password?(console.log("账号登录"),h({title:"登录中"}),uni.vk.userCenter.login({data:{username:this.mobile,password:this.password},loading:!1,success:async e=>{await this.login_success()},fail:e=>{console.log("err",e),this.$refs.toast.show({model:"error",text:e.msg})},complete:e=>{x()}})):uni.vk.alert("请输入账号密码"):uni.vk.alert("请选阅读并同意协议")},login_by_sms(){this.if_agree?uni.vk.pubfn.test(this.mobile,"mobile")?(console.log("验证码登录"),this.$refs.toast.show({model:"wait",text:"登录中...",mask:!0}),uni.vk.userCenter.loginBySms({data:{mobile:this.mobile,code:this.verifica_code},loading:!1,success:async e=>{await this.login_success()},fail:e=>{console.log("err",e),uni.vk.alert(e.msg)}})):uni.vk.alert("不是正确的手机号码"):uni.vk.alert("请选阅读并同意协议")},async send_verifica_code(){if(console.log("this.mobile",this.mobile),console.log("this.mobile",uni.vk.pubfn.test(this.mobile,"mobile")),uni.vk.pubfn.test(this.mobile,"mobile")){if(console.log(uni.vk.pubfn.test(this.mobile,"mobile")),60!=this.count_down_num)return;{let e=await this.verifyCaptcah();console.log("verify_res",e),this.captcha="",0==e.code&&(this.start_count_down(),y({title:"提示",content:"短信验证码已发送",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}}))}}else y({title:"提示",content:"请输入正确的手机号码",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}})}}},[["render",function(l,o,a,s,r,d){const p=I(v("tm-notification"),e),f=I(v("tm-message"),T),g=k,h=m,x=I(v("tm-sheet"),V),y=I(v("tm-text"),j),z=I(v("uni-segmented-control"),S),D=_,P=I(v("tm-button"),B),W=I(v("tm-badge"),$),K=I(v("tm-divider"),F),N=I(v("tm-input"),U),q=I(v("tm-image"),L),A=w,E=C;return t(),n(h,{class:"white"},{default:i((()=>[c(p,{placement:"top",ref:"msg"},null,512),c(f,{ref:"toast"},null,512),c(h,{class:"flex flex-col flex-center pa-30"},{default:i((()=>[c(x,{padding:[0,0],margin:[15,15],shadow:10,round:5},{default:i((()=>[c(h,{class:"flex pa-10 white round-3"},{default:i((()=>[c(x,{padding:[10,10],margin:[15,15],shadow:10,round:5},{default:i((()=>[c(h,{class:"flex flex-center"},{default:i((()=>[c(g,{src:"/client/assets/logo-caadcd87.png",style:{width:"80rpx",height:"80rpx","border-radius":"40rpx"},mode:"aspectFill"})])),_:1})])),_:1})])),_:1})])),_:1}),c(y,{class:"text-red text-size-g text-weight-b pt-20",color:"red"},{default:i((()=>[u("朋友圈集赞大师")])),_:1})])),_:1}),c(z,{current:r.login_type_index,values:r.login_type_list,onClickItem:d.change_login_method,styleType:"button",activeColor:"#007aff"},null,8,["current","values","onClickItem"]),c(x,null,{default:i((()=>[c(h,null,{default:i((()=>[0==r.login_type_index?(t(),n(h,{key:0},{default:i((()=>[c(h,{class:"flex flex-col flex-center ma-10",style:{height:"300rpx"}},{default:i((()=>[c(D,{class:"text-align-center text-red ma-20"},{default:i((()=>[u("请确保你已打开数据开关(非WiFi)")])),_:1}),c(W,{count:"推荐",color:"pink",linear:"right",linearDeep:"accent"},{default:i((()=>[c(P,{margin:[0,0],shadow:1,round:20,width:300,label:"本机号码一键登录",onClick:d.loginByUniverify},null,8,["onClick"])])),_:1})])),_:1})])),_:1})):b("",!0),1==r.login_type_index?(t(),n(h,{key:1},{default:i((()=>[c(h,null,{default:i((()=>[c(y,{"font-size":24,_class:"font-weight-b",label:"登录(无账号自动注册)"}),c(K)])),_:1}),c(N,{shadow:1,prefixLabel:"手机",color:"white",focusColor:"blue",margin:[10,24],round:24,height:90,prefix:"tmicon-user-circle",placeholder:"输入手机号码",modelValue:r.mobile,"onUpdate:modelValue":o[0]||(o[0]=e=>r.mobile=e),align:"right",type:"number"},null,8,["modelValue"]),c(N,{shadow:1,prefixLabel:"验证码",disabled:!1,color:"white",focusColor:"blue",margin:[10,24],round:24,height:90,prefix:"tmicon-mail",placeholder:"请输入",align:"right",modelValue:r.verifica_code,"onUpdate:modelValue":o[1]||(o[1]=e=>r.verifica_code=e)},{right:i((()=>[c(P,{margin:[0,0],shadow:0,round:20,_class:"round-20",text:"",size:"normal",label:r.verifica_text,onClick:d.send_verifica_code},null,8,["label","onClick"])])),_:1},8,["modelValue"]),c(h,{class:"flex flex-row flex-center"},{default:i((()=>[c(P,{margin:[0,0],shadow:1,round:20,_class:"round-20",size:"normal",label:"登录",onClick:d.login_by_sms},null,8,["onClick"])])),_:1})])),_:1})):b("",!0),2==r.login_type_index?(t(),n(h,{key:2},{default:i((()=>[c(h,null,{default:i((()=>[c(y,{"font-size":24,_class:"font-weight-b",label:"登录(需要用户曾登录之后设置密码)"}),c(K)])),_:1}),c(N,{shadow:1,prefixLabel:"手机",color:"white",focusColor:"blue",margin:[10,24],round:24,height:90,prefix:"tmicon-user-circle",placeholder:"请输入号码",modelValue:r.mobile,"onUpdate:modelValue":o[2]||(o[2]=e=>r.mobile=e),align:"right",type:"number"},null,8,["modelValue"]),c(N,{shadow:1,prefixLabel:"密码",disabled:!1,color:"white",focusColor:"blue",margin:[10,24],round:24,height:90,prefix:"tmicon-key",placeholder:"请输入密码",align:"right",type:"password",modelValue:r.password,"onUpdate:modelValue":o[3]||(o[3]=e=>r.password=e)},null,8,["modelValue"]),c(h,{class:"flex flex-row flex-center"},{default:i((()=>[c(P,{margin:[0,0],shadow:1,round:20,_class:"round-20",size:"normal",label:"登录",onClick:d.login_by_password},null,8,["onClick"])])),_:1})])),_:1})):b("",!0),3==r.login_type_index?(t(),n(h,{key:3},{default:i((()=>[c(h,null,{default:i((()=>[c(y,{"font-size":24,_class:"font-weight-b",label:"登录(需要用户拥有微信)"}),c(K)])),_:1}),c(h,{class:"flex flex-col flex-center flex-col-center-center mt-30",onClick:d.refresh_login_status},{default:i((()=>[(t(),n(q,{padding:[5,5],preview:"",width:300,height:300,src:r.login_qr_code,key:l.item},null,8,["src"])),c(y,{color:"blue",class:"mb-30"},{default:i((()=>[u("扫一扫登录")])),_:1}),c(P,{margin:[0,0],shadow:1,round:20,size:"normal",label:"我已扫码登录"})])),_:1},8,["onClick"])])),_:1})):b("",!0)])),_:1}),c(h,{class:"flex flex-row flex-center ma-20",onClick:d.change_agree},{default:i((()=>[c(E,{class:"radio"},{default:i((()=>[c(A,{value:"r1",checked:r.if_agree},null,8,["checked"])])),_:1}),c(D,{class:"text-grey text-size-s"},{default:i((()=>[u("我已阅读并同意")])),_:1}),c(D,{class:"text-blue text-size-s",onClick:o[4]||(o[4]=e=>d.to_path("/pages/about/agreement"))},{default:i((()=>[u("用户协议")])),_:1}),c(D,{class:"text-grey text-size-s"},{default:i((()=>[u("和")])),_:1}),c(D,{class:"text-blue text-size-s",onClick:o[5]||(o[5]=e=>d.to_path("/pages/about/policy"))},{default:i((()=>[u("隐私条款")])),_:1})])),_:1},8,["onClick"]),c(h,{class:"flex flex-row flex-between"},{default:i((()=>[c(y,{color:"blue",class:"",onClick:d.forget_password,label:"忘记密码"},null,8,["onClick"]),c(y,{color:"blue",class:"",label:"更多帮助",onClick:d.more_help},null,8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-1703b0a8"]]);export{P as default};
