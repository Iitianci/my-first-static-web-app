import{_ as t}from"./tm-notification.f2273359.js";import{o as e,c as i,w as s,e as a,t as o,G as l,E as n,f as c,l as _,a as r,P as h,n as d,j as u,b as m,d as f,r as g,F as p,h as y,i as x,S as b,_ as v,W as w,k}from"./index-f5cba0e4.js";import{r as C}from"./uni-app.es.62a9cda9.js";import{_ as j}from"./tm-message.42d12b93.js";import{_ as z}from"./tm-tabs.492def44.js";import{_ as T}from"./tm-skeleton-line.9799a71e.js";import{_ as U}from"./tm-sheet.38d3d718.js";import{_ as S}from"./tm-icon.ed97db34.js";import{_ as Y}from"./tm-app.c7c4bc54.js";import{b as V,g as $}from"./api.f04a1197.js";import{_ as E}from"./_plugin-vue_export-helper.1b428a4d.js";import"./tm-text.d010834d.js";import"./useWindowInfo.47d82cea.js";import"./tm-badge.vue_vue_type_script_setup_true_lang.38983ab0.js";import"./useTheme.d1454919.js";const I=E({name:"UniTag",emits:["click"],props:{type:{type:String,default:"default"},size:{type:String,default:"normal"},text:{type:String,default:""},disabled:{type:[Boolean,String],default:!1},inverted:{type:[Boolean,String],default:!1},circle:{type:[Boolean,String],default:!1},mark:{type:[Boolean,String],default:!1},customStyle:{type:String,default:""}},computed:{classes(){const{type:t,disabled:e,inverted:i,circle:s,mark:a,size:o,isTrue:l}=this;return["uni-tag--"+t,"uni-tag--"+o,l(e)?"uni-tag--disabled":"",l(i)?"uni-tag--"+t+"--inverted":"",l(s)?"uni-tag--circle":"",l(a)?"uni-tag--mark":"",l(i)?"uni-tag--inverted uni-tag-text--"+t:"","small"===o?"uni-tag-text--small":""].join(" ")}},methods:{isTrue:t=>!0===t||"true"===t,onClick(){this.isTrue(this.disabled)||this.$emit("click")}}},[["render",function(t,r,h,d,u,m){const f=_;return h.text?(e(),i(f,{key:0,class:l(["uni-tag",m.classes]),style:n(h.customStyle),onClick:m.onClick},{default:s((()=>[a(o(h.text),1)])),_:1},8,["class","style","onClick"])):c("",!0)}],["__scopeId","data-v-f9b60738"]]);const G=E({components:{wallpaperCard:E({name:"wallpaper-card",emits:["change_full_status","to_change_choose"],props:{first_loding:{type:String,default:""},action:{type:String,default:"view"},material_item:{type:Object,default:{}},index:{type:Number,default:66},avatar:{type:String,default:""},info:{type:String,default:"此人很懒,没有介绍"},nickname:{type:String,default:"好看的头像"}},data:()=>({vk:uni.vk,is_full:!1,current_item:{},current_index:0}),computed:{},methods:{to_change_choose(t,e){this.current_index=e,this.current_item=t;let i=this.material_item.item_list[this.current_index].cloud_url;r("img_list",[i]);let s={need_jump:!1,need_check_ad_review:!0,in_time:h((new Date).getTime()),item:{type_text:"wallpaper"}};d({url:`/pages/matetial/detail?extraData=${encodeURIComponent(JSON.stringify(s))}`})},change_full_status(t){this.$emit("change_full_status",t)},async click_down(){console.log("下载",this.current_index);let t=this.material_item.item_list[this.current_index].cloud_url;this.$emit("click_down",{down_url:t,down_type:"img"})},to_full_show(t,e){console.log("index",e),this.current_index=e,this.current_item=t,this.is_full=!0,this.change_full_status(this.is_full)},async next_item(){if(this.current_index>=this.material_item.item_list.length-1)return console.log("no more"),void uni.vk.toast("没有更多了","none");this.current_index++,this.current_item=this.material_item.item_list[this.current_index]},before_item(){if(this.current_index<=0)return console.log("is the first"),void uni.vk.toast("已经是第一个","none");this.current_index--,this.current_item=this.material_item.item_list[this.current_index]},start(t){this.clientX=t.changedTouches[0].clientX,this.clientY=t.changedTouches[0].clientY},async end(t){const e=t.changedTouches[0].clientX-this.clientX,i=t.changedTouches[0].clientY-this.clientY;i>50||e>50?(console.log("下滑或左划"),this.before_item()):(i<-50||e<-50)&&(console.log("上滑或右划"),this.next_item())},exit_full(){this.is_full=!1,this.change_full_status(this.is_full)}}},[["render",function(t,a,o,l,n,c){const _=C(y("tm-message"),j),r=C(y("tm-skeleton-line"),T),h=u,d=x,b=C(y("uni-tag"),I),v=C(y("tm-sheet"),U);return e(),i(h,null,{default:s((()=>[m(_,{ref:"toast"},null,512),m(h,null,{default:s((()=>[o.first_loding?(e(),f(p,{key:0},g(20,((t,i)=>m(h,null,{default:s((()=>[m(h,{class:"flex flex-row flex-center"},{default:s((()=>[(e(),f(p,null,g(5,(t=>m(h,{class:"ma-5",style:{width:"150rpx"}},{default:s((()=>[m(r,{height:300,width:145})])),_:1}))),64))])),_:1})])),_:1}))),64)):(e(),i(h,{key:1,class:"flex flex-row flex-row-center-center"},{default:s((()=>[m(v,{class:"flex flex-row flex-col-center-center",round:5,margin:[5,5]},{default:s((()=>[m(h,{class:"flex flex-row flex-center flex-wrap mx-10",style:{width:"730rpx"}},{default:s((()=>[(e(!0),f(p,null,g(o.material_item.item_list,((t,a)=>(e(),i(h,null,{default:s((()=>[(e(),i(d,{style:{width:"230rpx",height:"420rpx"},class:"ma-5",src:t.cloud_url+"?x-oss-process=image/resize,w_275,m_lfit",mode:"aspectFill",onClick:e=>c.to_change_choose(t,a),key:a},null,8,["src","onClick"])),m(h,{class:"absolute b-20 l-10"},{default:s((()=>[m(b,{circle:!0,text:"预览",type:"primary",size:"small",onClick:e=>c.to_change_choose(t,a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1}))])),_:1})])),_:1})}],["__scopeId","data-v-22604558"]])},data:()=>({vk:uni.vk,is_fixed:!1,dbName:"wallpaper",matetial_type:"wallpaper",choose_list_drawer_show:!1,first_loding:!0,action:"view",up_tips_show:!0,choose_show:!1,hideBtn:!1,is_full:!1,is_loading:!1,active_tabs_index:0,current_cid:1,current_index:1,current_id:"",current_zh_type:"城市",current_item:{},had_choose_list:[],windowHeight:"",category_list:[{type:"cityscape",title:"城市",zh_type:"城市",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/91379fad-4ea1-41c1-bcab-4fcc46886768.jpg",item_list:[]},{type:"animal",title:"动物",zh_type:"动物",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/149863c3-542d-444b-9f6a-c325cbd800bc.jpg",item_list:[]},{type:"landscape",title:"风景",zh_type:"风景",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/b07494e2-c115-4448-9605-4b325ba3c1fb.jpg",item_list:[]},{type:"text",title:"文字",zh_type:"文字",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/a60f8ced-fb42-4f60-b469-68a4440b7f17.jpg",item_list:[]},{type:"vision",title:"视觉",zh_type:"视觉",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/7395939c-6646-4528-a85b-efbb6d57d078.jpg",item_list:[]},{type:"emotion",title:"情感",zh_type:"情感",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/d958953d-d947-485e-9275-6e87cbd138f7.jpg",item_list:[]},{type:"creative",title:"设计",zh_type:"设计",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/25af7772-cbd8-4de9-bf55-7713cc3811cc.jpg",item_list:[]},{type:"stuff",title:"物语",zh_type:"物语",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/c3ee66ec-91da-4557-ba76-e9ef8760b227.jpg",item_list:[]},{type:"machine",title:"机械",zh_type:"机械",cover:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-b74408a4-6771-44cf-973b-5ff9c7684807/ac17d8c8-e550-4e91-b3fb-4cfca8f0a627.jpg",item_list:[]}],scrollTop:0,show_to_top:!1,nickname_list:[],avatar_list:[],can_max_choose:100}),computed:{},onPageScroll(t){t.scrollTop>200?this.show_to_top=!0:this.show_to_top=!1},onReachBottom(){this.get_list_data()},methods:{finish_download(t){console.log("下载完成",t)},async click_down(t){console.log("父节点click_down",t),this.$refs.down_matetial.click_down(t)},async open_choose_list(){this.$refs.choose_list_popup.open("right")},previewImage(t){console.log("预览图片",t),b({current:t,urls:[t],loop:!0,longPressActions:{itemList:[],success:function(t){console.log("选中了第"+(t.tapIndex+1)+"个按钮,第"+(t.index+1)+"张图片")},fail:function(t){console.log(t.errMsg)}}})},async finish_choose(){if(0==this.had_choose_list.length)return;let t=await uni.vk.callFunction({url:"client/select_material/kh/add",title:"",data:{dbName:this.dbName,type:this.matetial_type,item_list:this.had_choose_list}});0==t.code?(console.log("选材成功!"),this.$refs.toast.show({text:"选材成功!",model:"success",mask:!0,wait:2e3}),v({url:"/pages/matetial/detail?guide_show=true&share_code="+t.share_code})):this.$refs.toast.show({text:t.msg,model:"error",mask:!0,wait:2e3})},unchoose_all(){uni.vk.toast("取消中..","none",2e3);let t=this.category_list[this.active_tabs_index].item_list.length;for(let e=0;e<t;e++){let t=this.category_list[this.active_tabs_index].item_list[e];t.had_choose&&this.to_change_choose({item:t,index:e})}uni.vk.toast("取消成功","none",2e3)},choose_all(){uni.vk.toast("正在选择中..","none",2e3);let t=this.category_list[this.active_tabs_index].item_list.length,e=this.can_max_choose-this.had_choose_list.length,i=t>e?e:t,s=0;for(let a=0;a<t;a++){let t=this.category_list[this.active_tabs_index].item_list[a];if(!t.had_choose&&(this.to_change_choose({item:t,index:a}),s++,s>=i))return}uni.vk.toast("选择成功","none",1e3)},to_change_choose(t){let{item:e,index:i}=t;console.log("父组件",e);let s=!this.category_list[this.active_tabs_index].item_list[i].had_choose;if(this.category_list[this.active_tabs_index].item_list[i].had_choose=s,s){if(this.had_choose_list.length>=this.can_max_choose)return void console.log("超过单次最大选择数量了");this.had_choose_list.push(e)}else for(let a=0;a<this.had_choose_list.length;a++)if(this.had_choose_list[a]._id==e._id){this.had_choose_list.splice(a,1);break}},rm_choose(t,e){this.had_choose_list.splice(t,1);for(let i=0;i<this.category_list[this.active_tabs_index].item_list.length;i++)if(this.category_list[this.active_tabs_index].item_list[i]._id==e){this.category_list[this.active_tabs_index].item_list[i].had_choose=!1;break}},async tab_change(t){console.log("tab_change",t),this.active_tabs_index=t,this.current_zh_type=this.category_list[this.active_tabs_index].zh_type,0==this.category_list[this.active_tabs_index].item_list.length&&(this.first_loding=!0,await this.get_list_data(),setTimeout((()=>{this.first_loding=!1}),500))},async choose_platform(t){console.log("e",t);let{index:e,data:i}=t;"QQ"==i?console.log("打开QQ小程序"):"微信"==i&&console.log("打开微信小程序")},async to_get_avatar_byId(t){if(t){let e=await V("avatar",t);0==e.code&&(this.avatar_list=[e.data,...this.avatar_list])}},to_top(){w({scrollTop:0,duration:300})},async tabs_change(t){this.current_cid=parseInt(this.category_list[t].cid),0==this.category_list[t].item_list.length&&this.get_list_data()},async get_list_data(){if(this.is_loadding)return;this.is_loadding=!0;let t={};"全部"!=this.current_zh_type&&(t={zh_type:this.current_zh_type});let e=await $(this.dbName,t,1,30);if(console.log("res",e),0==e.code&&null!=e.data){let t=e.data;for(let e=0;e<t.length;e++)t[e].had_choose=!1;console.log("img_data",t),this.category_list[this.active_tabs_index].item_list=[...this.category_list[this.active_tabs_index].item_list,...t]}else if(0==e.code&&null==e.data)return;this.is_loadding=!1},async next_item(){if(this.current_index>=this.avatar_list.length-1)return console.log("no more"),void this.$refs.toast.show({text:"没有更多了",model:"info",mask:!0,wait:2e3});this.current_index++,this.current_item=this.avatar_list[this.current_index],this.avatar_list.length-this.current_index<=20&&(console.log("去加载下一页"),await this.get_list_data())},before_item(){if(this.current_index<=0)return console.log("is the first"),void this.$refs.toast.show({text:"已经是第一个了",model:"info",mask:!0,wait:2e3});this.current_index--,this.current_item=this.avatar_list[this.current_index]},start(t){this.clientX=t.changedTouches[0].clientX,this.clientY=t.changedTouches[0].clientY},async end(t){const e=t.changedTouches[0].clientX-this.clientX,i=t.changedTouches[0].clientY-this.clientY;i>50||e>50?(console.log("下滑或左划"),this.before_item()):(i<-50||e<-50)&&(console.log("上滑或右划"),this.next_item())},exit_full(){this.is_full=!1}},async onLoad(t={}){this.windowHeight=uni.vk.getVuex("$sys.sys.windowHeight")*uni.vk.getVuex("$sys.sys.devicePixelRatio")+"rpx",this.first_loding=!0,this.action=t.action||"view",this.active_tabs_index=parseInt(t.active_tabs_index)||0,this.current_cid=this.active_tabs_index+1||1},async onReady(){await this.get_list_data(),setTimeout((()=>{this.first_loding=!1}),200),"choose"==this.action?this.is_fixed=!0:this.is_fixed=!1}},[["render",function(o,l,n,_,r,h){const d=C(y("tm-notification"),t),x=C(y("tm-message"),j),b=C(y("tm-tabs"),z),v=u,w=C(y("tm-skeleton-line"),T),V=C(y("tm-sheet"),U),$=k("wallpaperCard"),E=C(y("tm-icon"),S),I=C(y("tm-app"),Y);return e(),i(I,null,{default:s((()=>[m(d,{placement:"top",ref:"msg"},null,512),m(x,{ref:"toast"},null,512),m(v,{class:"fixed zIndex-10"},{default:s((()=>[m(b,{list:r.category_list,border:1,width:750,height:300,"default-name":r.active_tabs_index,round:2,color:"grey",activeName:r.active_tabs_index,itemModel:"line",text:"",activeFontColor:"primary",unSelectedColor:"grey-darken-2",onChange:h.tab_change},null,8,["list","default-name","activeName","onChange"])])),_:1}),m(v,{style:{"margin-top":"100rpx"}},{default:s((()=>[r.first_loding?(e(),f(p,{key:0},g(10,((t,i)=>m(v,null,{default:s((()=>[m(V,{_class:"shadow-1 round-5",class:"round-5",padding:[20,30],margin:[25,10]},{default:s((()=>[m(v,{class:"flex flex-row flex-center"},{default:s((()=>[(e(),f(p,null,g(3,(t=>m(v,{class:"ma-10",style:{width:"210rpx"}},{default:s((()=>[m(w,{height:420,width:210})])),_:1}))),64))])),_:1})])),_:1})])),_:1}))),64)):(e(),i(v,{key:1},{default:s((()=>[m($,{material_item:r.category_list[r.active_tabs_index],first_loding:r.first_loding,onChange_full_status:o.change_full_status,onClick_down:h.click_down,onTo_change_choose:h.to_change_choose,action:r.action},null,8,["material_item","first_loding","onChange_full_status","onClick_down","onTo_change_choose","action"])])),_:1}))])),_:1}),r.is_loading?(e(),i(v,{key:0,style:{"margin-bottom":"250rpx"}},{default:s((()=>[a("> "),m(E,{spin:"","font-size":50,name:"tmicon-loading",color:"blue"})])),_:1})):c("",!0),r.show_to_top?(e(),i(v,{key:1,class:"to_top border-1-bk shadow-10",onClick:h.to_top},{default:s((()=>[m(E,{"font-size":45,shadow:10,name:"tmicon-arrow-alt-from-botto",color:"black"})])),_:1},8,["onClick"])):c("",!0)])),_:1})}],["__scopeId","data-v-51113c7d"]]);export{G as default};
