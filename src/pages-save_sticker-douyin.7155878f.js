import{s as e,n as t,g as s,ab as o,M as l,o as i,c as a,w as c,j as n,b as r,d as u,r as h,F as m,e as d,h as _,l as g,t as p,E as f,i as x}from"./index-f5cba0e4.js";import{_ as w}from"./tm-carousel.vue_vue_type_script_setup_true_lang.5fe38e15.js";import{r as v}from"./uni-app.es.62a9cda9.js";import{_ as y}from"./tm-button.37a1a22f.js";import{_ as b}from"./tm-modal.70c18b3d.js";import{_ as k}from"./_plugin-vue_export-helper.1b428a4d.js";import"./tm-image.vue_vue_type_script_setup_true_lang.e60a99a6.js";import"./tm-sheet.38d3d718.js";import"./useTheme.d1454919.js";import"./tm-text.d010834d.js";import"./tm-icon.ed97db34.js";import"./tm-translate.1353da0c.js";import"./tm-overlay.d3e45220.js";import"./useWindowInfo.47d82cea.js";let T=0;const j=k({data:()=>({openid:"",msg_list:[],msgid:"",down_img_list:[],current_url:"",token:"",cookies:"",preview_img_show:!1,touching:!1,overdue:!0,hasMore:!0,listimg:["https://picsum.photos/200/300?id=43335","https://picsum.photos/200/300?id=433","https://picsum.photos/200/300?id=439","https://picsum.photos/200/300?id=459"]}),onShow(){console.log("onshow"),setTimeout((()=>{this.show_interstitialAd()}),7e3),console.log("尚未跳转过广告")},onHide(){console.log("onhide"),console.log("尚未点击看广告")},async onReachBottom(){console.log("触底"),await this.get_sticker()},async onLoad(e={}){await this.get_sticker(),setInterval((()=>{this.touching=!1}),2e3)},computed:{img_style(){let e={filter:"blur(20px)"};return this.touching&&(e={}),e}},methods:{touchcancel(){this.touching=!1},touchmove(){0==this.touching&&(this.touching=!0)},touchend(){console.log("@touchend"),this.touching=!1},touchstart(){console.log("touchstart"),this.touching=!0},async get_sticker(){if(console.log("获取数据----------------"),!this.hasMore)return void console.log("没有更多了");let e=await uni.vk.callFunction({url:"client/douyin/pub/comment_list",title:"请求中...",data:{cursor:T,item_id:"",count:50}});console.log("dataRes",e);let{code:t,msg:s,has_more:o,cursor:l,data:i}=e;0==t&&(T=l,this.hasMore=o,this.msg_list=[...this.msg_list,...i])},to_mini(){e({title:"提示",content:"表情包已准备好,请前往领取",showCancel:!1,success:e=>{e.confirm&&uni.navigateToMiniProgram({appId:"wxb234a8d765b52bbe",path:"pages/wx_msg/save_sticker",envVersion:"develop",extraData:{msgid:this.msgid,token:this.token,cookies:this.cookies,in_time:0},success:e=>{console.log("跳转res:",e)}})}})},to_reward_ad(){},show_interstitialAd(){},to_page(e){t({url:e})},to_save_img(e){this.current_url=e,(new Date).getTime(),s("last_reward_ad_time");let t=Math.floor(10*Math.random());console.log("can_view_ad:",true,"rand_num",t),this.to_reward_ad()},async download_img(){},to_save(e){uni.authorize({scope:"scope.writePhotosAlbum",success:()=>{this.saveImg(e)},complete:()=>{uni.getSetting({success:t=>{t.authSetting["scope.writePhotosAlbum"]||this.opensit(e)}})}})},async saveImg(e){e&&o({filePath:e,success:e=>{console.log("res",e),l({title:"保存成功"})},fail:e=>{console.log("err",e),l({title:"保存失败"})}})},opensit(t){e({content:"是否授权小程序保存图片到相册？",success:s=>{s.confirm?uni.openSetting({success:e=>{console.log(e.authSetting),this.saveImg(t)}}):s.cancel&&e({cancelText:"依然取消",confirmText:"重新授权",content:"很遗憾你点击了取消，这将无法进行保存操作",success:e=>{e.confirm?uni.openSetting({success:e=>{console.log(e.authSetting)}}):e.cancel&&console.log("用户拒绝授权，无法保存图片")}})}})}}},[["render",function(e,t,s,o,l,k){const T=v(_("tm-carousel"),w),j=v(_("tm-button"),y),M=n,C=x,S=g,I=v(_("tm-modal"),b);return i(),a(M,{onTouchstart:k.touchstart,onTouchend:k.touchend,onTouchcancel:k.touchcancel,onTouchmove:k.touchmove},{default:c((()=>[r(T,{autoplay:"",margin:[0,16],round:3,width:686,height:300,list:l.listimg},null,8,["list"]),r(M,{class:"flex flex-row flex-center"},{default:c((()=>[r(j,{label:"查看使用教程",color:"green",width:400,height:80,round:20,onClick:t[0]||(t[0]=e=>k.to_page("/pages/web/web"))})])),_:1}),(i(!0),u(m,null,h(l.msg_list,((t,s)=>(i(),a(M,null,{default:c((()=>[r(M,{class:"felx flex-row flex-center"},{default:c((()=>[r(M,{class:"white shadow-10 flex flex-row pa-20 ma-20 round-10",style:{width:"500rpx"}},{default:c((()=>[r(C,{src:t.user_info.avatar_url,mode:"aspectFill",style:{width:"60rpx",height:"60rpx","border-radius":"30rpx"}},null,8,["src"]),r(M,{class:"mx-20 px-20"},{default:c((()=>[r(S,{class:"text-size-s"},{default:c((()=>[d(p(t.user_info.screen_name),1)])),_:2},1024),r(S,{class:"text-blue text-size-xs"},{default:c((()=>[d(p(e.vk.pubfn.timeFormat(t.create_time,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(M,{class:"flex flex-row flex-center",style:f(k.img_style)},{default:c((()=>[r(C,{src:t.image_list[0].url_list[0],style:{width:"600rpx"},mode:"widthFix"},null,8,["src"])])),_:2},1032,["style"]),t.image_list[0].url_list[0]?(i(),a(M,{key:0,class:"flex flex-row flex-center"},{default:c((()=>[r(j,{label:"查看/保存",width:400,height:80,round:20,onClick:e=>k.to_save_img(t.image_list[0].url_list[0])},null,8,["onClick"])])),_:2},1024)):(i(),a(M,{key:1,class:"flex flex-row flex-center"},{default:c((()=>[r(j,{label:"等待加载中",width:400,color:"grey",height:80,round:20})])),_:1}))])),_:2},1024)))),256)),r(I,{color:"white",okColor:"blue",cancelColor:"grey",splitBtn:"",title:"提示",content:"",height:500,overlayClick:!1,okText:"好的",width:700,show:l.preview_img_show,"onUpdate:show":t[1]||(t[1]=e=>l.preview_img_show=e),onOk:k.to_reward_ad,closeable:"",cancelText:"取消"},{default:c((()=>[r(M,null,{default:c((()=>[r(M,{class:"flex flex-row flex-center"},{default:c((()=>[r(S,{class:"text-weight-b text-red text-size-g"},{default:c((()=>[d("生活不易,望支持")])),_:1})])),_:1}),r(M,{class:"flex flex-col"},{default:c((()=>[r(M,{class:""},{default:c((()=>[r(S,{class:"text-red"},{default:c((()=>[d("观看完整视频之后")])),_:1})])),_:1}),r(M,{class:""},{default:c((()=>[r(S,{class:"text-red"},{default:c((()=>[d('点击底部的"了解更多","立刻领取","关注","查看"等按钮')])),_:1})])),_:1}),r(M,{class:"flex flex-row"},{default:c((()=>[r(S,{class:"text-blue"},{default:c((()=>[d("跳转之后预览2-5秒再返回即可")])),_:1})])),_:1}),r(M,{class:"flex flex-row"},{default:c((()=>[r(S,null,{default:c((()=>[d("你的支持是我的动力,赏个🍗吧")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show","onOk"])])),_:1},8,["onTouchstart","onTouchend","onTouchcancel","onTouchmove"])}]]);export{j as default};
