import{a as e,P as t,n as s,o,c as l,w as i,j as a,b as r,e as n,f as c,d as u,r as h,F as m,h as d,l as _,t as g,E as f,i as p}from"./index-f5cba0e4.js";import{_ as x}from"./tc-banner.8b43f15b.js";import{r as w}from"./uni-app.es.62a9cda9.js";import{_ as v}from"./tm-button.37a1a22f.js";import{_ as y}from"./_plugin-vue_export-helper.1b428a4d.js";import"./tm-carousel.vue_vue_type_script_setup_true_lang.5fe38e15.js";import"./tm-image.vue_vue_type_script_setup_true_lang.e60a99a6.js";import"./tm-sheet.38d3d718.js";import"./useTheme.d1454919.js";import"./tm-text.d010834d.js";import"./tm-icon.ed97db34.js";import"./tm-translate.1353da0c.js";let b=0;const k=y({data:()=>({openid:"",item_id:"",msg_list:[],msgid:"",down_img_list:[],current_url:"",token:"",platform:"",cookies:"",preview_img_show:!1,touching:!1,overdue:!0,hasMore:!0}),async onReachBottom(){console.log("触底"),this.overdue||await this.get_sticker()},async onLoad(e={}){b=0,this.item_id=e.item_id||"",this.platform=e.platform||"";let t=e.in_time||0,s=(new Date).getTime();Math.abs(s-t)<3e5?(this.overdue=!1,await this.get_sticker()):this.overdue=!0,setInterval((()=>{this.touching=!1}),2e3)},computed:{img_style(){let e={filter:"blur(10px)"};return this.touching&&(e={}),e}},methods:{touchcancel(){this.touching=!1},touchmove(){0==this.touching&&(this.touching=!0)},touchend(){console.log("@touchend"),this.touching=!1},touchstart(){console.log("touchstart"),this.touching=!0},async get_sticker(){if(console.log("获取数据----------------"),!this.hasMore)return console.log("没有更多了"),void uni.vk.toast("没有更多了");console.log("cursor",b),console.log("item_id",this.item_id);let e=await uni.vk.callFunction({url:`client/${this.platform}/pub/comment_list`,title:"请求中...",data:{cursor:b,item_id:this.item_id,count:50}});console.log("dataRes",e);let{code:t,msg:s,has_more:o,cursor:l,pursor:i}=e;0==t&&(b=l||0,this.hasMore=o,null==l&&(this.hasMore=!1),this.msg_list=[...this.msg_list,...e.data])},to_save_img(o){e("img_list",[o]);let l={need_jump:!1,need_check_ad_review:!0,in_time:t((new Date).getTime()),item:{type_text:"kouling"}};s({url:`/pages/matetial/detail?extraData=${encodeURIComponent(JSON.stringify(l))}`})}}},[["render",function(e,t,s,y,b,k){const j=w(d("tc-banner"),x),T=_,M=a,F=w(d("tm-button"),v),I=p;return o(),l(M,{onTouchstart:k.touchstart,onTouchend:k.touchend,onTouchcancel:k.touchcancel,onTouchmove:k.touchmove},{default:i((()=>[r(j),b.overdue?(o(),l(M,{key:0,class:"flex flex-row flex-center"},{default:i((()=>[r(T,{class:"text-weight-b text-red text-align-center text-size-xl"},{default:i((()=>[n("你的发送信息已过期,请重新发送")])),_:1})])),_:1})):c("",!0),r(M,{class:"flex flex-row flex-center"},{default:i((()=>[r(F,{label:"查看使用教程",color:"green",width:400,height:80,round:20,onClick:t[0]||(t[0]=t=>e.to_page("/pages/web/web"))})])),_:1}),(o(!0),u(m,null,h(b.msg_list,((t,s)=>(o(),l(M,null,{default:i((()=>[r(M,{class:"felx flex-row flex-center"},{default:i((()=>[r(M,{class:"white shadow-10 flex flex-row flex-between pa-20 ma-20 round-10",style:{width:"600rpx"}},{default:i((()=>[r(I,{src:t.headurl,mode:"aspectFill",style:{width:"60rpx",height:"60rpx","border-radius":"30rpx"}},null,8,["src"]),r(M,{class:"mx-20 px-20 flex flex-col"},{default:i((()=>[r(T,{class:"text-size-s"},{default:i((()=>[n(g(t.authorName),1)])),_:2},1024),r(T,{class:"text-blue text-size-xs"},{default:i((()=>[n(g(e.vk.pubfn.timeFormat(t.create_time,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024)])),_:2},1024),r(M,{class:"px-20 mx-10 white shadow-10 round-10 text-green"},{default:i((()=>[r(T,null,{default:i((()=>[n("给ta＋🍗")])),_:1})])),_:1})])),_:2},1024)])),_:2},1024),r(M,{class:"flex flex-row flex-center",style:f(k.img_style)},{default:i((()=>[r(I,{src:t.emotionImg,style:{width:"600rpx"},mode:"widthFix"},null,8,["src"])])),_:2},1032,["style"]),t.emotionImg?(o(),l(M,{key:0,class:"flex flex-row flex-center"},{default:i((()=>[r(F,{label:"查看/保存",width:400,height:80,round:20,onClick:e=>k.to_save_img(t.emotionImg)},null,8,["onClick"])])),_:2},1024)):(o(),l(M,{key:1,class:"flex flex-row flex-center"},{default:i((()=>[r(F,{label:"等待加载中",width:400,color:"grey",height:80,round:20})])),_:1}))])),_:2},1024)))),256))])),_:1},8,["onTouchstart","onTouchend","onTouchcancel","onTouchmove"])}]]);export{k as default};
