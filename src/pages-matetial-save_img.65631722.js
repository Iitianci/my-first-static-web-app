import{g as e,S as t,n as o,H as s,Q as i,ak as l,J as r,o as a,c as n,w as c,j as m,b as d,e as u,f as h,l as _,h as g,i as p,p as f}from"./index-f5cba0e4.js";import{_ as w}from"./tm-modal.70c18b3d.js";import{r as x}from"./uni-app.es.62a9cda9.js";import{_ as k}from"./tm-button.37a1a22f.js";import{c as y,a as j,b as v,d as b}from"./check_user_info.62ff098e.js";import{_ as C}from"./_plugin-vue_export-helper.1b428a4d.js";import"./tm-translate.1353da0c.js";import"./tm-text.d010834d.js";import"./tm-icon.ed97db34.js";import"./tm-overlay.d3e45220.js";import"./useWindowInfo.47d82cea.js";import"./tm-sheet.38d3d718.js";import"./useTheme.d1454919.js";let A=null,I={};const z=C({mixins:[y,j,v],data:()=>({openid:"",msg_list:[],down_img_list:[],current_url:"",msgid:"",token:"",img_type:"",cookies:"",in_time:0,preview_img_show:!1,touching:!1}),onShow(){setTimeout((()=>{console.log("展示插屏"),this.show_interstitialAd()}),8e3)},async onLoad(t={}){if(b(),I=e("extraData"),console.log("extraData",I),I){let{msgid:e,cookies:t,token:s,in_time:i,img_type:l,imgUrl:r}=I;try{console.log("进行重新赋值"),this.msgid=e,this.cookies=t,this.token=s,this.in_time=parseInt(i),this.img_type=l,this.current_url=r,r.match(/http/)||this.download_img()}catch(o){console.log("err--",o)}}wx.createInterstitialAd&&(A=wx.createInterstitialAd({adUnitId:"adunit-09a20a3b768a3da8"}),A.onLoad((()=>{console.log("插屏广告加载成功")})),A.onError((e=>{console.log("插屏广告加载失败")})),A.onClose((()=>{console.log("插屏广告关闭")})))},methods:{to_preview_img(){this.show_interstitialAd(),t({urls:[this.current_url]})},show_interstitialAd(){A&&A.show().catch((e=>{console.error("插屏展示失败",e)}))},to_page(e){o({url:e})},async download_img(){console.log("下载图片中");let e="";e="office_sticker"==this.img_type?`https://mp.weixin.qq.com/cgi-bin/downloadfile?msgid=${this.msgid}&token=${this.token}&lang=zh_CN`:this.current_url,s({title:"正在下载中..",mask:!0}),i({url:e,header:{Cookie:this.cookies,"Content-Type":"image/jpeg"},success:e=>{console.log("下载res",e),200===e.statusCode&&(console.log("下载成功"),this.current_url=e.tempFilePath,l(this.current_url,[this.current_url],!1))},fail:e=>{console.log("err",e)},complete:()=>{r()}})},to_save(){l(this.current_url,[this.current_url],!0)}}},[["render",function(e,t,o,s,i,l){const r=_,y=m,j=x(g("tm-modal"),w),v=p,b=x(g("tm-button"),k),C=f;return a(),n(y,null,{default:c((()=>[e.overdue?(a(),n(y,{key:0,class:"flex flex-row flex-center"},{default:c((()=>[d(r,{class:"text-weight-b text-red text-align-center text-size-xl"},{default:c((()=>[u("你的发送的素材已过期,请重新发送")])),_:1})])),_:1})):h("",!0),d(j,{color:"white",okColor:"blue",cancelColor:"grey",splitBtn:"",title:"提示",content:"",height:600,overlayClick:!1,okText:"知道了",hideCancel:"",width:600,show:i.preview_img_show,"onUpdate:show":t[0]||(t[0]=e=>i.preview_img_show=e),onOk:l.to_preview_img},{default:c((()=>[d(y,{class:"flex flex-row flex-center"},{default:c((()=>[d(r,{class:"text-weight-b text-red text-size-g"},{default:c((()=>[u("长按可进行保存图片")])),_:1})])),_:1})])),_:1},8,["show","onOk"]),d(y,null,{default:c((()=>[d(y,{class:"flex flex-row flex-center"},{default:c((()=>[d(v,{src:i.current_url,style:{width:"600rpx"},mode:"widthFix"},null,8,["src"])])),_:1}),i.current_url?(a(),n(y,{key:0,class:"flex flex-row flex-center"},{default:c((()=>[d(b,{label:"保存到相册",width:400,height:80,round:20,onClick:l.to_save},null,8,["onClick"])])),_:1})):(a(),n(y,{key:1,class:"flex flex-row flex-center"},{default:c((()=>[d(b,{label:"等待加载中",width:400,color:"grey",height:80,round:20})])),_:1}))])),_:1}),d(y,null,{default:c((()=>[d(C,{"unit-id":"adunit-1300561868721049","ad-type":"video","ad-theme":"white"})])),_:1})])),_:1})}]]);export{z as default};
