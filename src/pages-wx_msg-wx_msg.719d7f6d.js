import{a as e,m as t,n as l,Q as s,o as a,c as o,w as i,b as r,f as d,e as c,d as n,r as x,F as _,i as m,j as u,l as f,h,t as p}from"./index-f5cba0e4.js";import{_ as g}from"./tm-tag.vue_vue_type_script_setup_true_lang.4df7467e.js";import{r as w}from"./uni-app.es.62a9cda9.js";import{_ as y}from"./tm-button.37a1a22f.js";import{_ as v}from"./tm-app.c7c4bc54.js";import{c as b,a as k,b as z}from"./check_user_info.62ff098e.js";import{_ as j}from"./_plugin-vue_export-helper.1b428a4d.js";import"./tm-sheet.38d3d718.js";import"./useTheme.d1454919.js";import"./tm-text.d010834d.js";import"./tm-icon.ed97db34.js";import"./tm-translate.1353da0c.js";import"./useWindowInfo.47d82cea.js";let F=1,D={};const C=j({mixins:[b,k,z],data:()=>({msg_list:[],chatroom_id:"",openid:"",had_more:!0}),async onLoad(t={}){if(console.log("options",t),F=1,t.extraData){D=JSON.parse(decodeURIComponent(null==t?void 0:t.extraData)),console.log("extraData",D);let{type:l,code:s,openid:a}=D;a&&(this.openid=a,e("openid",a)),"chatroom_msg"==l&&s&&(this.chatroom_id=s,this.get_msg_data(this.chatroom_id))}else console.log("没有extraData")},async onPullDownRefresh(){this.msg_list=[],F=1,this.had_more=!0,await this.get_msg_data(this.chatroom_id),t()},async onReachBottom(){await this.get_msg_data(this.chatroom_id)},methods:{async get_msg_data(e){if(console.log("获取数据"),!e||!this.had_more)return;let t=await uni.vk.callFunction({url:"client/chatroom/pub/get_msg",title:"请求中...",data:{pageIndex:F,pageSize:20,chatroom_id:e},env:"wx-robot"});if(0==t.code&&uni.vk.pubfn.isNotNull(t.data)){F++;let e=this.msg_list.length;this.msg_list=[...this.msg_list,...t.data];let l=this.msg_list.length;console.log(e,l)}else this.had_more=!1},to_detail(e){console.log("item------",e),D={...D,item:e,need_check_ad_review:!1},l({url:"/pages/matetial/detail?extraData="+encodeURIComponent(JSON.stringify(D))})},async down_img(e,t){for(let l=e;l<t;l++)s({url:this.msg_list[l].img_url,success:e=>{200===e.statusCode&&(console.log("下载成功",e),this.msg_list[l].img_url=e.tempFilePath)}})}}},[["render",function(e,t,l,s,b,k){const z=m,j=u,F=f,D=w(h("tm-tag"),g),C=w(h("tm-button"),y),N=w(h("tm-app"),v);return a(),o(N,null,{default:i((()=>[0==b.msg_list.length?(a(),o(j,{key:0,class:"flex flex-row flex-center"},{default:i((()=>[r(z,{src:"/client/static/bg/null.png",style:{width:"450rpx"},mode:"widthFix"})])),_:1})):d("",!0),b.openid&&e.overdue?(a(),o(j,{key:1},{default:i((()=>[r(j,{class:"flex flex-row flex-center"},{default:i((()=>[r(F,{class:"text-weight-b text-red text-align-center text-size-xl"},{default:i((()=>[c("你的发送的素材已过期,请重新发送")])),_:1})])),_:1})])),_:1})):d("",!0),e.overdue?d("",!0):(a(),o(j,{key:2},{default:i((()=>[(a(!0),n(_,null,x(b.msg_list,((e,t)=>(a(),o(j,{class:"flex flex-row flex-between",onClick:t=>k.to_detail(e)},{default:i((()=>[r(j,{class:"ma-20 pa-20 shadow-10 round-10 white flex flex-row",style:{width:"500rpx"}},{default:i((()=>["office_article"==e.type_text?(a(),o(j,{key:0},{default:i((()=>[r(j,{class:"flex flex-row flex-center"},{default:i((()=>[r(j,null,{default:i((()=>[r(z,{src:e.cdn_url_1_1,style:{width:"200rpx",height:"200rpx"},mode:"aspectFill"},null,8,["src"]),r(j,null,{default:i((()=>[r(D,{text:"",shadow:0,icon:"tmicon-weixin",color:"green",size:"m",label:"公众号"})])),_:1})])),_:2},1024),r(j,{class:"ma-10",style:{width:"200rpx"}},{default:i((()=>[r(F,{class:"text-weight-s text-size-xs ma-20 text-overflow-3"},{default:i((()=>[c(p(e.msg_title),1)])),_:2},1024),r(F,{class:"text-weight-s text-size-xs ma-20 text-overflow-3 text-red"},{default:i((()=>[c("可提取文章的所有图片,包括封面")])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)):d("",!0),"mp_app"==e.type_text?(a(),o(j,{key:1},{default:i((()=>[r(j,{class:"flex flex-row flex-center"},{default:i((()=>[r(j,null,{default:i((()=>[r(z,{src:e.weappiconurl,style:{width:"200rpx",height:"200rpx"},mode:"aspectFill"},null,8,["src"]),r(j,null,{default:i((()=>[r(D,{text:"",shadow:0,icon:"tmicon-xiaochengxu\r\nt",color:"purple",size:"m",label:"小程序"})])),_:1})])),_:2},1024),r(j,{class:"ma-10",style:{width:"200rpx"}},{default:i((()=>[r(F,{class:"text-weight-s text-size-xs ma-20 text-overflow-3"},{default:i((()=>[c(p(e.title),1)])),_:2},1024),r(F,{class:"text-weight-s text-size-xs ma-20 text-overflow-3 text-red"},{default:i((()=>[c("可提取成小程序码,二维码,短链接,注意:这是中转,但不影响最终效果")])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)):d("",!0),"wx_sticker"==e.type_text?(a(),o(j,{key:2},{default:i((()=>[r(j,{class:"flex flex-row flex-center"},{default:i((()=>[r(j,null,{default:i((()=>[r(z,{src:e.img_url,style:{width:"200rpx",height:"200rpx"},mode:"aspectFill"},null,8,["src"]),r(j,null,{default:i((()=>[r(D,{text:"",shadow:0,icon:"tmicon-wind-smile",color:"yellow",size:"m",label:"表情包"})])),_:1})])),_:2},1024),r(j,{class:"ma-10",style:{width:"200rpx"}},{default:i((()=>[r(F,{class:"text-weight-s text-size-xs ma-20 text-overflow-3 text-red"},{default:i((()=>[c("可提取表情到本地,然后在其他软件平台添加")])),_:1})])),_:1})])),_:2},1024)])),_:2},1024)):d("",!0),"shipinghao"==e.type_text?(a(),o(j,{key:3},{default:i((()=>[r(j,{class:"flex flex-row flex-center"},{default:i((()=>[r(j,null,{default:i((()=>[r(z,{src:e.cover_url,style:{width:"200rpx",height:"200rpx"},mode:"aspectFill"},null,8,["src"]),r(j,null,{default:i((()=>[r(D,{text:"",shadow:0,icon:"tmicon-playcircle",color:"orange",size:"m",label:"视频号"})])),_:1})])),_:2},1024),r(j,{class:"ma-10",style:{width:"200rpx"}},{default:i((()=>[r(F,{class:"text-weight-s text-size-xs ma-20 text-overflow-3 text-red"},{default:i((()=>[c("可提取无水印的视频到本地")])),_:1})])),_:1})])),_:2},1024)])),_:2},1024)):d("",!0),"short_video"==e.type_text?(a(),o(j,{key:4},{default:i((()=>[r(j,{class:"flex flex-row flex-center"},{default:i((()=>[r(j,null,{default:i((()=>[r(z,{src:null==e?void 0:e.cover_url,style:{width:"200rpx",height:"200rpx"},mode:"aspectFill"},null,8,["src"]),r(j,null,{default:i((()=>[1==(null==e?void 0:e.type)?(a(),o(D,{key:0,text:"",shadow:0,icon:"tmicon-playcircle",color:"deep-orange",size:"m",label:"短视频"})):(a(),o(D,{key:1,text:"",shadow:0,icon:"tmicon-picture-fill",color:"green",size:"m",label:"图集"}))])),_:2},1024)])),_:2},1024),r(j,{class:"ma-10",style:{width:"200rpx"}},{default:i((()=>[r(F,{class:"text-weight-s text-size-xs ma-20 text-overflow-3 text-grey"},{default:i((()=>[c(p(null==e?void 0:e.title),1)])),_:2},1024),r(F,{class:"text-weight-s text-size-xs ma-20 text-overflow-3 text-red"},{default:i((()=>[c("可提取无水印的视频和图集到本地")])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)):d("",!0)])),_:2},1024),r(j,{class:"flex flex-row flex-center ma-20"},{default:i((()=>[r(C,{label:"提取",width:150,height:80,round:10})])),_:1})])),_:2},1032,["onClick"])))),256))])),_:1}))])),_:1})}]]);export{C as default};
